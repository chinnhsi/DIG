webpackJsonp([1],{"+wL7":function(e,t){},"/24z":function(e,t){},"0GEF":function(e,t){},"4TzI":function(e,t,a){"use strict";t.a=function(e,t,a,i,n,s,l){var o=new function(){var e={panel:document.querySelector(".label-sign"),submit:document.querySelector(".label-sign-submit"),cancel:document.querySelector(".label-sign-cancel"),text:document.querySelector(".label-sign-text"),selector:document.querySelector(".label-sign-selector"),question:document.querySelector(".label-sign-question")},t=void 0;return this.load=function(a,i,n){if(i=+i.toFixed(2),n=+n.toFixed(2),0==a.type?e.question.innerHTML="请输入描述":1==a.type?e.question.innerHTML="请填空或清空输入描述":e.question.innerHTML=a.question.replace("$","___"),1==a.type?e.text.value=a.question.replace("$","___"):e.text.value="",2==a.type){e.selector.innerHTML="";var s=!0,l=!1,o=void 0;try{for(var c,u=a.selector[Symbol.iterator]();!(s=(c=u.next()).done);s=!0){var d=c.value,f=document.createElement("option");f.value=d,f.innerHTML=d,e.selector.appendChild(f)}}catch(e){l=!0,o=e}finally{try{!s&&u.return&&u.return()}finally{if(l)throw o}}e.selector.style.display="initial",e.text.value=a.question.replace("$",a.selector[0])}else e.selector.style.display="none";return e.panel.style.display="flex",t=a,new Promise(function(t,a){var s=function a(){console.log('Add mark "'+e.text.value+'" at '+i+" to "+n),r.add((new Date).getTime(),i,n,e.text.value),e.submit.removeEventListener("click",a),e.cancel.removeEventListener("click",l),e.panel.style.display="none",t(e.text.value)},l=function t(){e.submit.removeEventListener("click",s),e.cancel.removeEventListener("click",t),e.panel.style.display="none",a(e.text.value)};e.submit.addEventListener("click",s),e.cancel.addEventListener("click",l)})},e.selector.addEventListener("change",function(){e.text.value=t.question.replace("$",e.selector.options[e.selector.selectedIndex].value)}),this},r=new function(e,a){var i=[],n=document.querySelector(".label-list-ul"),s=function(){e.showMark(+this.getAttribute("data-start"),+this.getAttribute("data-end"))},l=function(){e.hideMark()},o=function(e,a,o,r){i.push({labelId:t.labelId,type:0,startTime:a,endTime:o,sentence:r});var c=document.createElement("div");c.innerHTML=' <li class="label-video-list-item">\n            <div class="label-list-header"><span>'+a+"</span><span>"+o+'</span></div>\n            <div class="label-list-content">\n                '+r+'\n            </div>\n            <div class="label-list-options">\n                <span data-id="'+e+'" class="iconfont icon-shanchu label-list-delete  label-video-btn"></span>\n                <span data-start="'+a+'" data-end="'+o+'" class="iconfont icon-kejian label-list-visible label-video-btn"></span>\n            </div>\n        </li>',c.children[0].querySelector(".label-list-visible").addEventListener("mouseenter",s),c.children[0].querySelector(".label-list-visible").addEventListener("mouseleave",l),c.children[0].querySelector(".label-list-delete").addEventListener("click",function(){for(var e=0;e<i.length;e++){var t=i[e];t.startTime==a&&t.endTime==o&&t.sentence==r&&i.splice(e,1)}this.parentElement.parentElement.remove()}),n.appendChild(c.children[0])};this.add=o,this.save=function(){return i};var r=function(e){console.log(e),i=[],n.innerHTML="";var t=!0,a=!1,s=void 0;try{for(var l,r=e[Symbol.iterator]();!(t=(l=r.next()).done);t=!0){var c=l.value;o((new Date).getTime(),c.startTime,c.endTime,c.sentence)}}catch(e){a=!0,s=e}finally{try{!t&&r.return&&r.return()}finally{if(a)throw s}}};return r(a),this.reload=function(t,a){e.reload(a),r(t)},this}(new e(document.querySelector(".label-video"),i,function(e,a){return console.log(t),new Promise(function(i,n){o.load(t,e,a).then(function(e){i(e)}).catch(function(e){n(e)})})},n,l,s),a);return r}},"88+d":function(e,t){},EwH0:function(e,t,a){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.a=function(e,t,a,n,s,l){var o={frame:e.querySelector(".bfplayer"),main:e.querySelector(".bf-main"),video:e.querySelector(".bf-video"),controller:e.querySelector(".bf-controller"),menu:e.querySelector(".bf-menu"),loading:e.querySelector(".bf-loading-panel"),capture:{panel:e.querySelector(".bf-capture"),start:e.querySelector(".bf-btn-start"),end:e.querySelector(".bf-btn-end")},pgb:{panel:e.querySelector(".bf-pgb-player"),buffer:e.querySelector(".bf-pgb-buffer"),played:e.querySelector(".bf-pgb-played"),select:e.querySelector(".bf-pgb-select"),point:e.querySelector(".bf-pgb-point"),img:e.querySelector(".bf-pgb-point>div")},btn:{play:e.querySelector(".bf-btn-play"),fullbrowser:e.querySelector(".bf-btn-fullbrowser"),fullscreen:e.querySelector(".bf-btn-fullscreen"),volume:e.querySelector(".bf-btn-volume"),save:e.querySelector(".bf-btn-save"),previous:e.querySelector(".bf-btn-previous"),next:e.querySelector(".bf-btn-next")},panel:{volume:{area:e.querySelector(".bf-volume-area"),panel:e.querySelector(".bf-volume"),value:e.querySelector(".bf-volume-value"),point:e.querySelector(".bf-volume-point")}},time:e.querySelector(".bf-label-time"),selectTime:e.querySelector(".bf-label-select-time")},r={time:"0:00",duration:0,controll:{lock:!0,time:0,pf:void 0},pgbMousedown:!1,pgbLock:!1,pgbLeft:0,fullscreen:!1,fullbrowser:!1,select:{enable:!1,start:0,persent:0}},c={keydown:function(e){if("INPUT"!=e.target.tagName)switch(e.key){case" ":o.video.paused?o.video.play():o.video.pause();break;case"ArrowLeft":o.video.currentTime>2?o.video.currentTime-=2:o.video.currentTime=0,p.reload();break;case"ArrowRight":o.video.duration-o.video.currentTime>5?o.video.currentTime+=5:o.video.currentTime=o.video.duration,p.reload();break;case"ArrowUp":if(r.snackbarLock)break;o.video.volume>=1?d("音量已经达到最大值"):o.video.volume=+(o.video.volume+.1>=1?1:o.video.volume+.1).toFixed(1),p.reload();break;case"ArrowDown":if(r.snackbarLock)break;o.video.volume<=0?d("当前是静音状态"):o.video.volume=+(o.video.volume-.1<=0?0:o.video.volume-.1).toFixed(1),p.reload();break;case"A":case"a":p.reload(),c.capture.start();break;case"S":case"s":p.reload(),c.capture.end();break;case"W":case"w":f.clientToggle();break;case"F":case"f":f.screenToggle()}},mouseleave:function(){clearTimeout(r.controll.pf),r.controll.time=3,p.timer()},mousemove:function(e){p.reload()},mousemoveall:function(e){r.pgbMousedown&&u(e)},mousedown:function(e){if(2==e.button){if(e.target.classList.contains("bf-nomenu"))return;r.menuShow=!0;var t=e.pageY-this.scrollTop-54,a=e.pageX-this.scrollLeft;this.scrollHeight-t<80&&(t=this.scrollHeight-80),this.scrollWidth-a<230&&(a=this.scrollWidth-230),o.menu.style.left=a+"px",o.menu.style.top=t+"px",o.menu.style.display="inherit"}else if(0==e.button){if("LI"==e.target.tagName)return;"none"!=o.menu.style.display?o.menu.style.display="none":e.target!=o.video&&e.target!=o.controller||(o.video.paused?o.video.play():o.video.pause())}},mouseup:function(e){r.pgbMousedown&&(o.pgb.panel.classList.remove("bf-pgb-player-notransition"),e.target!=o.pgb.img&&(o.pgb.point.style.display="none",o.pgb.panel.classList.remove("bf-pgb-player-enter")),r.pgbMousedown=!1,r.pgbLock=!0,o.video.currentTime=o.pgb.time)},pgb:{mousedown:function(e){r.pgbMousedown||0!=e.button||(r.controll.lock=!0,r.pgbMousedown=!0,this.classList.add("bf-pgb-player-notransition"),r.pgbLeft=o.frame.scrollLeft+20,u(e))},img:function(e){e.preventDefault()},mouseenter:function(e){this.classList.add("bf-pgb-player-enter"),o.pgb.point.style.display="inherit"},mouseleave:function(e){r.pgbMousedown||(this.classList.remove("bf-pgb-player-enter"),o.pgb.point.style.display="none")}},video:{timeupdate:function(e){if(r.pgbLock)r.pgbLock=!1,!o.video.paused&&(r.controll.lock=!1,p.reload());else if(!r.pgbMousedown){var t=this.currentTime/this.duration;if(o.pgb.played.style.width=100*t+"%",o.time.innerHTML=v.format(this.currentTime)+" / "+r.time,o.pgb.point.style.left=(o.frame.scrollWidth-40)*t+"px",r.select.enable){r.controll.lock=!0;var a=o.pgb.select.style;if(a.left=(o.frame.scrollWidth-40)*r.select.persent+"px",(t=(this.currentTime-r.select.start)/this.duration)<0)return r.select.enable=!1,a.display="none",void(o.selectTime.style.display="none");o.selectTime.innerHTML="已选择："+r.select.start+" - "+this.currentTime,a.width=100*t+"%"}}},play:function(){r.qrcode&&c.btn.qrcode();var e=o.btn.play.getElementsByTagName("span")[0].classList;e.remove("bf-icon-play"),e.add("bf-icon-pause"),r.controll.lock=!1,p.reload()},progress:function(){o.pgb.buffer.style.width=v.getBufferTime(this.buffered)/this.duration*100+"%"},error:function(){},canplay:function(){o.loading.style.display="none",r.duration=this.duration},waiting:function(){o.loading.style.display="block"},ended:function(){},pause:function(){var e=o.btn.play.getElementsByTagName("span")[0].classList;e.add("bf-icon-play"),e.remove("bf-icon-pause"),r.controll.lock=!0,p.show()},volumechange:function(){c.volume.change(this.volume)},loadstart:function(){c.video.pause()},durationchange:function(){r.time=v.format(this.duration),o.time.innerHTML="0:00 / "+r.time}},btn:{play:function(){o.video.paused?o.video.play():o.video.pause()},fullscreen:function(){r.fullscreen?f.exitScreen():r.fullbrowser?f.exitClient():f.screen()},fullbrowser:function(){r.fullbrowser?f.exitClient():r.fullscreen?f.exitScreen():f.client()},volume:function(){this.lastValue?(o.video.volume=this.lastValue,this.lastValue=!1):(this.lastValue=o.video.volume,o.video.volume=0)},next:function(){l&&l()},previous:function(){s&&s()},save:function(){n&&n()}},capture:{start:function(){r.controll.lock=!0,r.select.start=o.video.currentTime;var e=o.video.currentTime/o.video.duration;r.select.persent=e;var t=o.pgb.select.style;t.left=(o.frame.scrollWidth-40)*e+"px",t.display="initial",t.width="0%",o.selectTime.style.display="initial",r.select.enable=!0},end:function(){r.select.enable?(r.controll.lock=!1,r.select.enable=!1,o.video.pause(),a(r.select.start,o.video.currentTime).then(function(e){d("添加标记成功")}).catch(function(e){d("添加标记失败")}).then(function(){o.pgb.select.style.display="none",o.selectTime.style.display="none"})):d("请先设置初始点")}},tooltip:{show:function(e){this.bottom=!1,this.moveLock=!1,this.classList.contains("bf-selector")&&null!=this.querySelector(".bf-selector-panel")&&(this.bottom=!0);var t=this.getAttribute("data-tooltip"),a=this.querySelector(".bf-tip");null==a?((a=document.createElement("div")).innerHTML=t,a.classList.add("bf-tip"),this.appendChild(a),this.classList.contains("bf-tooltip-left")?(a.style.top=this.offsetHeight/2-a.offsetHeight/2+"px",a.style.left=-a.offsetWidth-5+"px"):(a.style.top=this.bottom?5:-a.offsetHeight-5+"px",a.style.left=-a.offsetWidth/2+this.offsetWidth/2+"px"),this.tooltip=a):a.innerHTML=t},hide:function(){this.moveLock=!1;var e=this.querySelector(".bf-tip");null!=e&&e.remove()},move:function(){this.moveLock||null==this.querySelector(".bf-selector-panel")||(this.moveLock=!0,this.bottom=!0),this.bottom&&(this.tooltip.style.top="15px")}},selector:{show:function(e){var t=void 0,a=void 0,n=this.getAttribute("data-selector"),s=this.getAttribute("data-selector-type"),l="",o=document.createElement("div"),r=this,u=this.getAttribute("data-selector-event"),d=function e(){r.removeEventListener("mouseleave",e),t.lock=!1,setTimeout(function(){t.lock||(t.remove(),r.addEventListener("mouseenter",c.selector.show))},150)};"object"!=(void 0===n?"undefined":i(n))&&(n=JSON.parse(n));for(var f=0;f<n.length;f++)l+='<li data-index="'+f+'" data-value="'+n[f].value+'" class="bf-selector-item '+(n[f].active?"active":"")+'">'+n[f].name+"</li>",n[f].active=!1;t='<div class="bf-selector-panel"><ul>'+l+"</ul></div>",o.innerHTML=t,t=o.childNodes[0],this.appendChild(t),s&&"fixed"==s?(t.style.position="fixed",t.style.top=e.clientY+(r.offsetHeight-e.layerY)+"px",t.style.left=e.clientX+(r.offsetWidth/2-e.layerX)-t.offsetWidth/2+"px"):(t.style.top=-t.offsetHeight-10+"px",t.style.left=-t.offsetWidth/2+this.offsetWidth/2+"px"),a=this.querySelectorAll(".bf-selector-item");for(var p=0;p<a.length;p++)a[p].addEventListener("mousedown",function(){n[+this.getAttribute("data-index")].active=!0,r.setAttribute("data-selector",JSON.stringify(n)),r.setAttribute("data-value",this.getAttribute("data-value")),c[u](this.getAttribute("data-value")),t.remove(),r.addEventListener("mouseenter",c.selector.show)},!0);this.addEventListener("mouseleave",d),t.addEventListener("mouseenter",function(){t.lock=!0,r.removeEventListener("mouseleave",d),t.addEventListener("mouseleave",function(){t.remove(),r.addEventListener("mouseenter",c.selector.show)})}),this.removeEventListener("mouseenter",c.selector.show)}},volume:{lock:!1,moveLock:!1,pr:0,mouseenter:function(){o.panel.volume.area.style.display="initial",c.volume.lock=!0},mouseleave:function(){c.volume.lock=!1,c.volume.pr=setTimeout(function(){c.volume.lock||c.volume.hide()},180)},mouseenterTarget:function(){c.volume.lock=!0},mouseleaveTarget:function(){c.volume.lock=!1,!c.volume.moveLock&&c.volume.hide()},hide:function(){o.panel.volume.area.classList.add("bf-volume-hidden"),c.volume.pr=setTimeout(function(){c.volume.lock||c.volume.moveLock||(o.panel.volume.area.style.display="none",o.panel.volume.area.classList.remove("bf-volume-hidden"))},150)},mousedownTarget:function(e){var t=void 0,a=this.offsetLeft+this.parentElement.parentElement.offsetLeft+this.parentElement.parentElement.parentElement.parentElement.offsetLeft,i=function(e){t=(e.pageX-a)/80,o.video.volume=t<0?0:t>1?1:t};r.controll.lock=!0,c.volume.moveLock=!0,t=(e.pageX-a)/80,o.video.volume=t<0?0:t>1?1:t,o.panel.volume.panel.classList.add("bf-volume-noanimation"),document.addEventListener("mousemove",i,!0),document.addEventListener("mouseup",function e(){r.controll.lock=o.video.paused,c.volume.moveLock=!1,document.removeEventListener("mousemove",i,!0),document.removeEventListener("mouseup",e,!0),o.panel.volume.panel.classList.remove("bf-volume-noanimation")},!0)},change:function(e){var t=o.panel.volume.point,a=o.panel.volume.area,i=o.panel.volume.value,n=o.btn.volume.children[0].classList;a.style.display="initial",clearTimeout(c.volume.pr),n.remove("bf-icon-volumedown"),n.remove("bf-icon-volumemute"),n.remove("bf-icon-volumeoff"),n.remove("bf-icon-volumeup"),e>.7?n.add("bf-icon-volumeup"):e<.3&&e>0?n.add("bf-icon-volumemute"):0==e?n.add("bf-icon-volumeoff"):n.add("bf-icon-volumedown"),t.style.left=80*e+"px",i.style.width=80*e+"px",c.volume.pr=setTimeout(function(){c.volume.lock||c.volume.hide()},1e3)},bind:function(){o.btn.volume.addEventListener("mouseenter",c.volume.mouseenter),o.btn.volume.addEventListener("mouseleave",c.volume.mouseleave),o.panel.volume.panel.addEventListener("mousedown",c.volume.mousedownTarget),o.panel.volume.area.addEventListener("mouseenter",c.volume.mouseenterTarget),o.panel.volume.area.addEventListener("mouseleave",c.volume.mouseleaveTarget)}},changeRate:function(e){o.video.playbackRate=e}},u=function(e){var t=o.frame.scrollWidth-40,a=(e.pageX-r.pgbLeft)/t;a=a>=1?1:a<=0?0:a;var i=r.duration*a;o.pgb.played.style.width=100*a+"%",o.time.innerHTML=v.format(i)+" / "+r.time,o.pgb.point.style.left=a*t+"px",o.pgb.time=i},d=function(e){if(!r.snackbarLock){r.snackbarLock=!0;var t=o.frame.querySelector(".bf-snackbar"),a=void 0;null!=t&&(clearTimeout(r.snackbar),t.classList.add("bf-snackbar-hide"),setTimeout(function(){t.remove()},130)),(a=document.createElement("div")).classList.add("bf-snackbar"),a.appendChild(document.createTextNode(e)),o.frame.appendChild(a),a.style.left=o.frame.scrollWidth/2-a.scrollWidth/2+"px",r.snackbar=setTimeout(function(){a.classList.add("bf-snackbar-hide"),r.snackbar=setTimeout(function(){a.remove()},130)},5e3),r.snackbarLock=!1}},f={isFull:!1,type:0,screen:function(){var e=o.frame;document.addEventListener("webkitfullscreenchange",f.exitScreen),document.addEventListener("fullscreenchange",f.exitScreen),document.addEventListener("mozfullscreenchange",f.exitScreen),r.fullscreen=!0,f.isFull=!0,f.type=2,e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(),o.btn.fullscreen.setAttribute("data-tooltip","退出全屏"),d("已进入屏幕全屏")},client:function(){r.fullbrowser=!0,f.isFull=!0,f.type=1,o.frame.classList.add("bfplayer-full"),o.btn.fullbrowser.setAttribute("data-tooltip","退出全屏"),d("已进入网页全屏")},exitScreen:function(){r.fullscreen?r.fullscreen=!1:(f.isFull=!1,f.type=0,o.btn.fullscreen.setAttribute("data-tooltip","屏幕全屏"),document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen(),document.removeEventListener("webkitfullscreenchange",f.exitScreen),document.removeEventListener("fullscreenchange",f.exitScreen),document.removeEventListener("mozfullscreenchange",f.exitScreen),d("已退出屏幕全屏"))},exitClient:function(){r.fullbrowser=!1,f.isFull=!1,f.type=0,o.frame.classList.remove("bfplayer-full"),o.btn.fullbrowser.setAttribute("data-tooltip","网页全屏"),d("已退出网页全屏")},clientToggle:function(){f.isFull?1==f.type&&f.exitClient():f.client()},screenToggle:function(){f.isFull?2==f.type&&f.exitScreen():f.screen()}},p={show:function(){o.controller.removeAttribute("style"),o.capture.panel.removeAttribute("style"),o.frame.style.cursor="auto"},timer:function(){if(!r.controll.lock){if(r.controll.time++,r.controll.time>=3&&!r.controll.lock)return o.controller.classList.add("bf-controller-hide"),o.capture.panel.classList.add("bf-controller-hide"),void setTimeout(function(){r.controll.time>=3&&!r.controll.lock&&(r.controll.time=0,p.hidden())},210);r.controll.pf=setTimeout(function(){p.timer()},1e3)}},hidden:function(){o.controller.classList.remove("bf-controller-hide"),o.capture.panel.classList.remove("bf-controller-hide"),o.controller.style.display="none",o.capture.panel.style.display="none",o.frame.style.cursor="none"},reload:function(){r.controll.lock||(p.show(),clearTimeout(r.controll.pf),r.controll.time=0,p.timer())}},v={format:function(e){var t=(Math.floor(+e)/60).toFixed(3).split("."),a=(Number(t[1])/1e3*60).toFixed(0);return a=1==a.length?"0"+a:a,t[0]+":"+a},getBufferTime:function(e){var t=e.length;return e.end(t-1)}};return this.snackbar=d,this.reload=function(e){o.video.pause(),o.pgb.played.style.width="0",o.video.src=e,o.video.load()},this.showMark=function(e,t){if(r.select.enable)d("请先完成当前标记");else{var a=e/o.video.duration,i=o.pgb.select.style;i.left=(o.frame.scrollWidth-40)*a+"px",a=(t-e)/o.video.duration,i.display="initial",i.width=100*a+"%",o.selectTime.innerHTML="已选择："+e+" - "+t,o.selectTime.style.display="initial",p.reload(),r.controll.lock=!0}},this.hideMark=function(){o.selectTime.style.display="none",o.pgb.select.style.display="none",r.controll.lock=o.video.paused,p.reload()},function(){var e=void 0;for(var t in c.video)o.video.addEventListener(t,c.video[t]);for(var a in c.btn)o.btn[a].addEventListener("click",c.btn[a]),o.btn[a].addEventListener("click",function(e){e.stopPropagation()});o.capture.start.addEventListener("click",c.capture.start),o.capture.end.addEventListener("click",c.capture.end),o.pgb.panel.addEventListener("mouseenter",c.pgb.mouseenter),o.pgb.panel.addEventListener("mouseleave",c.pgb.mouseleave),o.pgb.img.addEventListener("mousedown",c.pgb.img,!0),o.pgb.panel.addEventListener("mousedown",c.pgb.mousedown),document.addEventListener("mousemove",c.mousemoveall,!0),document.addEventListener("mouseup",c.mouseup,!0),o.frame.addEventListener("keydown",c.keydown),o.frame.addEventListener("mousemove",c.mousemove),o.frame.addEventListener("mouseleave",c.mouseleave),o.frame.addEventListener("contextmenu",function(e){e.target.classList.contains("bf-nomenu")||e.preventDefault()}),e=o.frame.querySelectorAll(".bf-tooltip");var i=!0,n=!1,s=void 0;try{for(var l,r=e[Symbol.iterator]();!(i=(l=r.next()).done);i=!0){var u=l.value;u.addEventListener("mouseenter",c.tooltip.show),u.addEventListener("mousemove",c.tooltip.move),u.addEventListener("mouseleave",c.tooltip.hide)}}catch(e){n=!0,s=e}finally{try{!i&&r.return&&r.return()}finally{if(n)throw s}}e=o.frame.querySelectorAll(".bf-selector");var d=!0,f=!1,p=void 0;try{for(var v,m=e[Symbol.iterator]();!(d=(v=m.next()).done);d=!0)v.value.addEventListener("mouseenter",c.selector.show)}catch(e){f=!0,p=e}finally{try{!d&&m.return&&m.return()}finally{if(f)throw p}}o.frame.addEventListener("mousedown",c.mousedown),c.volume.bind()}(),o.video.src=t,this}},GTkh:function(e,t){},J373:function(e,t){},NHiN:function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0__assets_js_bfplayer_core__=__webpack_require__("EwH0"),__WEBPACK_IMPORTED_MODULE_1__assets_js_videolabel_core__=__webpack_require__("4TzI"),__WEBPACK_IMPORTED_MODULE_2__models_Video_js__=__webpack_require__("suMn"),__WEBPACK_IMPORTED_MODULE_3__models_Service_js__=__webpack_require__("c1um");__webpack_exports__.a={name:"VideoLabel",props:["id","tid","taskName","imagePage"],data:function(){return{loading:!0,activeIndex:"",penddingUserList:[],penddingUserSelectId:0,penddingUserActive:"user",task:{page:+this.imagePage,total:0,id:this.tid,list:[],index:0,name:this.taskName},videolabel:null,account:this.global.account}},watch:{id:function(){this.load(!0)}},methods:{load:function(e){1==this.account.group?this.getVideoInfo():3==this.account.group||2==this.account.group?e?this.getVideoInfo():this.getReviewerList():this.$message({type:"error",message:"尚未登录"}),0==this.account.group||e||this.getList().then().catch()},getVideoInfo:function getVideoInfo(){var _this=this;this.loading=!0,__WEBPACK_IMPORTED_MODULE_2__models_Video_js__.a.getVideo(this.id,1==this.account.group?this.account.id:this.penddingUserSelectId).then(function(data){var src=__WEBPACK_IMPORTED_MODULE_3__models_Service_js__.a+"/api/video/"+_this.taskName+"/"+data.data.video.videoName;console.log(data),_this.loading=!1,_this.videolabel?_this.videolabel.reload(data.data.datas,src):_this.videolabel=Object(__WEBPACK_IMPORTED_MODULE_1__assets_js_videolabel_core__.a)(__WEBPACK_IMPORTED_MODULE_0__assets_js_bfplayer_core__.a,{labelId:data.data.labels[0].labelId,question:data.data.labels[0].question,type:data.data.labels[0].type,selector:"string"==typeof data.data.labels[0].selector?eval(data.data.labels[0].selector):data.data.labels[0].selector},data.data.datas,src,function(){_this.loading=!0,__WEBPACK_IMPORTED_MODULE_2__models_Video_js__.a.saveVideoLabel(_this.id,_this.videolabel.save(),1==_this.account.group?_this.account.id:_this.penddingUserSelectId).then(function(){_this.$message({type:"success",message:"保存成功"})}).catch(function(){_this.$message({type:"error",message:"保存失败"})}).then(function(){_this.loading=!1})},function(){_this.next()},function(){_this.previous()})})},getReviewerList:function(){var e=this;__WEBPACK_IMPORTED_MODULE_2__models_Video_js__.a.getPendingUserList(this.id).then(function(t){var a=t.data;a.length>0?(e.activeIndex=a[0].userId+"",e.penddingUserSelectId=a[0].userId,e.getVideoInfo(),e.penddingUserList=a):e.$alert("该任务未分配用户标记","提示",{confirmButtonText:"确定",callback:function(t){e.$router.go(-1)}})})},penddingUserSelect:function(e){this.penddingUserSelectId=parseInt(e),this.getVideoInfo(!0)},setFinalVersion:function(){var e=this;this.loading=!0,__WEBPACK_IMPORTED_MODULE_2__models_Video_js__.a.setVideoFinalVersion(parseInt(this.id),this.penddingUserSelectId).then(function(){e.$message({type:"success",message:"设置成功"})}).catch(function(){e.$message({type:"error",message:"设置失败"})}).then(function(){e.loading=!1})},goBack:function(){var e=this;this.$confirm("未保存的进度将会丢失（删除操作也需要保存），确定返回？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$router.push("/task/"+e.tid+"/"+e.taskName+"/5")}).catch(function(){})},getList:function(e){var t=this;return new Promise(function(a,i){__WEBPACK_IMPORTED_MODULE_2__models_Video_js__.a.getVideoList(t.task.id,t.task.page).then(function(i){var n=i.data.videos;if(t.task.list=n,t.task.total=i.data.totalpages,!e)for(var s=0;s<n.length;s++)n[s].videoId==t.id&&(t.task.index=s);a()}).catch(function(){t.$message({type:"error",message:"获取列表失败"}),i()})})},next:function(){var e=this,t=this.task;if(t.list.length-1==t.index){if(t.page==t.total)return void this.$message({type:"warning",message:"已经是最后一个"});t.page++,this.getVideoInfo().then(function(){t.index=0,e.$router.push("/video/"+t.list[t.index].videoId+"/"+t.id+"/"+t.name+"/"+t.page)})}else console.log(t.list),++t.index,this.$router.push("/video/"+t.list[t.index].videoId+"/"+t.id+"/"+t.name+"/"+t.page)},previous:function(){var e=this,t=this.task;if(0==t.index){if(1==t.page)return void this.$message({type:"warning",message:"已经是第一个"});t.page--,this.getVideoInfo().then(function(){t.index=t.list.length-1,e.$router.push("/video/"+t.list[t.index].videoId+"/"+t.id+"/"+t.name+"/"+t.page)})}else--t.index,this.$router.push("/video/"+t.list[t.index].videoId+"/"+t.id+"/"+t.name+"/"+t.page)}},mounted:function(){this.load()}}},NHnr:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("7+uW"),n=a("/ocq"),s=a("c1um");var l={name:"Header",data:function(){return{account:this.global.account,name:s.b}},methods:{logout:function(){var e,t=this;document.cookie="",(e=this.account,Object(s.c)("/api/logout",e)).then(function(){t.$router.push("/login/dashboard")}).catch(function(){t.$message({type:"error",message:"退出登录失败，请重试"})})}},mounted:function(){}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"header-wrap"},[a("h1",[e._v("\n        "+e._s(e.name)+"\n        "),a("small")]),e._v(" "),a("div",{staticClass:"header-spacer"}),e._v(" "),a("div",{staticClass:"header-right"},[a("el-dropdown",{on:{command:e.logout}},[a("span",{staticClass:"el-dropdown-link"},[e._v("\n            "+e._s(e.account.username)+"\n            "),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",[e._v("Log out")])],1)],1)],1)])])],1)},staticRenderFns:[]};function r(e,t){var a=localStorage.getItem("group"),i=Object(s.g)(a),n=localStorage.getItem("id"),l={taskId:e,page:t,limit:30};return l[i+"Id"]=n,Object(s.e)("/api/"+i+"/getImgList",l)}var c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{height:"100%"}},[a("el-menu",{ref:"menu",staticStyle:{height:"100%"},attrs:{router:!0,"default-active":e.activedIndex}},[a("el-menu-item",{attrs:{route:{path:"/dashboard"},index:"/dashboard"}},[a("template",{slot:"title"},[a("i",{staticClass:"el-icon-pie-chart"}),e._v(" "),a("span",[e._v("仪表盘")])])],2),e._v(" "),3==e.account.group?a("el-menu-item",{attrs:{route:{path:"/user"},index:"/user"}},[a("template",{slot:"title"},[a("i",{staticClass:"el-icon-user"}),e._v(" "),a("span",[e._v("用户管理")])])],2):e._e(),e._v(" "),3==e.account.group?a("el-menu-item",{attrs:{route:{path:"/label"},index:"/label"}},[a("template",{slot:"title"},[a("i",{staticClass:"el-icon-camera"}),e._v(" "),a("span",[e._v("图片标签")])])],2):e._e(),e._v(" "),3==e.account.group?a("el-menu-item",{attrs:{route:{path:"/videolabel"},index:"/videolabel"}},[a("template",{slot:"title"},[a("i",{staticClass:"el-icon-video-camera"}),e._v(" "),a("span",[e._v("视频标签")])])],2):e._e(),e._v(" "),3==e.account.group?a("el-menu-item",{attrs:{route:{path:"/partition"},index:"/partition"}},[a("template",{slot:"title"},[a("i",{staticClass:"el-icon-finished"}),e._v(" "),a("span",[e._v("任务设置")])])],2):e._e(),e._v(" "),a("el-menu-item",{attrs:{route:{path:"/list"},index:"/list"}},[a("template",{slot:"title"},[a("i",{staticClass:"el-icon-document-checked"}),e._v(" "),a("span",[e._v("任务列表")])])],2)],1)],1)},staticRenderFns:[]};var u={name:"App",components:{Header:a("VU/8")(l,o,!1,function(e){a("lZzK")},"data-v-6b9bb4d0",null).exports,Aside:a("VU/8")({name:"Aside",data:function(){return{isCollapse:!1,taskList:this.global.task,activedIndex:this.$route.path,account:this.global.account,loading:!1}},methods:{},watch:{"$route.path":function(){this.activedIndex=this.$route.path}},mounted:function(){}},c,!1,function(e){a("mqF5")},"data-v-657ec700",null).exports},mounted:function(){}},d={render:function(){var e=this.$createElement,t=this._self._c||e;return t("el-container",{staticStyle:{height:"100%"}},[t("el-header",[t("Header")],1),this._v(" "),t("el-container",{staticStyle:{height:"calc(100% - 60px)"}},[t("el-aside",{staticStyle:{"padding-bottom":"5px",height:"100%"},attrs:{width:"200px"}},[t("Aside")],1),this._v(" "),t("el-main",[t("router-view")],1)],1)],1)},staticRenderFns:[]};var f=a("VU/8")(u,d,!1,function(e){a("xn2C")},"data-v-660eac73",null).exports,p={name:"Login",props:["path"],data:function(){return{form:{username:"",password:""},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},account:this.global.account,loading:!1}},methods:{login:function(){var e=this,t="/"+decodeURI(this.path.replace(/,/g,"/"));this.$refs.form.validate(function(a){if(!a)return!1;var i,n;e.loading=!0,(i=e.form.username,n=e.form.password,Object(s.e)("/api/login","username="+i+"&password="+n)).then(function(a){e.account.group="ROLE_ADMIN"==a.data.user.authorities?3:"ROLE_REVIEWER"==a.data.user.authorities?2:1,e.account.username=e.form.username,e.account.id=a.data.user.userId,e.account.token=a.data.token,localStorage.setItem("group",e.account.group),localStorage.setItem("username",e.form.username),localStorage.setItem("id",a.data.user.userId),localStorage.setItem("token",a.data.token),e.$message({type:"success",message:"登录成功"}),e.$router.push(t)}).catch(function(t){e.$alert(t.message+"("+t.code+")","登录失败",{confirmButtonText:"确定",type:"warning"})}).then(function(){e.loading=!1})})}},mounted:function(){}},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-container",[a("el-main",[a("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"box-card login-card"},[a("h1",[e._v("登录")]),e._v(" "),a("el-form",{ref:"form",attrs:{rules:e.rules,"hide-required-asterisk":!0,model:e.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"用户名",prop:"username"}},[a("el-input",{attrs:{placeholder:"用户名"},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{placeholder:"密码","show-password":""},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.login}},[e._v("登录")])],1)],1)],1)],1)],1)},staticRenderFns:[]};var m=a("VU/8")(p,v,!1,function(e){a("vGvD"),a("rJcc")},"data-v-7f06216b",null).exports,b={name:"app",props:["path"],data:function(){return{account:this.global.account}},mounted:function(){var e=this,t="/"+decodeURI(this.path.replace(/,/g,"/")),a=localStorage.getItem("group");a?Object(s.f)("/api/"+Object(s.g)(a)+"/getTaskList").then(function(){e.account.group=parseInt(localStorage.getItem("group")),e.account.username=localStorage.getItem("username"),e.account.id=localStorage.getItem("id"),e.account.token=localStorage.getItem("token"),e.$router.push(t)}).catch(function(){e.$router.push("/login/"+e.path)}):this.$router.push("/login"+t)}},h={render:function(){var e=this.$createElement;return(this._self._c||e)("p",[this._v("登录中...")])},staticRenderFns:[]},g=a("VU/8")(b,h,!1,null,null,null).exports,y={name:"Home",data:function(){return{account:this.global.account,userCount:0,reviewerCount:0,taskCount:0,loading:!1}},mounted:function(){var e=this;3==this.account.group&&(this.loading=!0,(this.account,Object(s.c)("/api/admin/getCount")).then(function(t){e.userCount=t.data.userCount,e.reviewerCount=t.data.reviewerCount,e.taskCount=t.data.taskCount}).catch(function(t){e.$message({type:"error",message:"获取仪表信息失败"})}).then(function(){e.loading=!1}))}},_={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[3==e.account.group?[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"dashboard"},[a("div",{staticClass:"dashboard-panel panel-number"},[a("div",{staticClass:"panel-header"},[e._v("\n          总任务数\n        ")]),e._v(" "),a("div",{staticClass:"panel-content"},[e._v("\n          "+e._s(e.taskCount)+"\n        ")])]),e._v(" "),a("div",{staticClass:"dashboard-panel panel-number"},[a("div",{staticClass:"panel-header"},[e._v("\n          总标记用户数\n        ")]),e._v(" "),a("div",{staticClass:"panel-content"},[e._v("\n          "+e._s(e.userCount)+"\n        ")])]),e._v(" "),a("div",{staticClass:"dashboard-panel panel-number"},[a("div",{staticClass:"panel-header"},[e._v("\n          总审核用户数\n        ")]),e._v(" "),a("div",{staticClass:"panel-content"},[e._v("\n          "+e._s(e.reviewerCount)+"\n        ")])])])]:e._e(),e._v(" "),e._m(0)],2)},staticRenderFns:[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"guide"},[a("h3",{staticClass:"section-title"},[e._v("图片标记指南")]),e._v(" "),a("p",[a("b",[e._v("关键点标记说明：")]),a("br"),e._v(" "),a("b",[e._v("下一个标签：")]),e._v("点击"),a("i",{staticClass:"iconfont icon-nextweek icon"}),e._v("进行下一个标签的标记。"),a("br"),e._v("\n      必须按逆序删除已经添加的标记，否则删除失败。"),a("br"),a("br"),e._v(" "),a("b",[e._v("移动/缩放（快捷键：W）：")]),e._v("点击"),a("i",{staticClass:"iconfont icon-yidong icon"}),e._v("可进行移动（鼠标按下移动）与缩放（鼠标滚轮滚动）。"),a("br"),e._v(" "),a("b",[e._v("多边形选择（快捷键：Q）：")]),e._v("点击"),a("i",{staticClass:"iconfont icon-duobianxing icon"}),e._v("进行多边形选择模式，在图片上点击进行标记。左键单击第一个点完成标记；右键单击第一个点取消标记。"),a("br"),e._v("此时你仍然可以按下移动/缩放按钮进行操作。"),a("br"),e._v(" "),a("b",[e._v("矩形选择（快捷键：R）：")]),e._v("点击"),a("i",{staticClass:"iconfont icon-kuangxuanquyu icon"}),e._v("进行矩形选择模式，在图片上某个点按下并拖动，完成选择。"),a("br"),e._v(" "),a("b",[e._v("编辑（快捷键：E）：")]),e._v("点击"),a("i",{staticClass:"iconfont icon-sheji icon"}),e._v("进入编辑模式，点击一个已存在的选择区域进行修改，按下点拖动鼠标可移动点，点击图片其他区域结束修改。"),a("br"),e._v(" "),a("b",[e._v("删除（快捷键：D）：")]),e._v("点击"),a("i",{staticClass:"iconfont icon-shanchu icon"}),e._v("进入删除模式，点击一个已存在的选择区域删除。"),a("br"),e._v(" "),a("b",[e._v("放大（快捷键：Z）：")]),e._v("点击"),a("i",{staticClass:"iconfont icon-fangda icon"}),e._v("按左上角放大。"),a("br"),e._v(" "),a("b",[e._v("放大（快捷键：C）：")]),e._v("点击"),a("i",{staticClass:"iconfont icon-suoxiao icon"}),e._v("按左上角缩小。"),a("br"),e._v(" "),a("b",[e._v("保存（快捷键：Ctrl+S）：")]),e._v("点击"),a("i",{staticClass:"iconfont icon-baocun icon"}),e._v("保存。"),a("br"),e._v(" "),a("b",[e._v("审核确认（快捷键：Ctrl+C）：")]),e._v("点击"),a("i",{staticClass:"iconfont icon-dui icon"}),e._v("确认选中版本（仅在管理员/审核用户模式下）。"),a("br"),e._v(" "),a("b",[e._v("上一个：")]),e._v("点击"),a("i",{staticClass:"iconfont icon-ai10 icon"}),e._v("进入上一个标记项目。"),a("br"),e._v(" "),a("b",[e._v("下一个：")]),e._v("点击"),a("i",{staticClass:"iconfont icon-ai09 icon"}),e._v("保存描述列表。"),a("br"),e._v("\n      在编辑/选择模式下必须结束标记才可进行下一次标记。\n    ")]),e._v(" "),a("h3",{staticClass:"section-title"},[e._v("视频标记指南")]),e._v(" "),a("p",[a("b",[e._v("播放（快捷键：SPACE）：")]),e._v("点击"),a("i",{staticClass:"bf-icon bf-icon-play icon"}),e._v("或者"),a("i",{staticClass:"bf-icon bf-icon-pause icon"}),e._v("开始播放/暂停。"),a("br"),e._v(" "),a("b",[e._v("设置起点（快捷键：A）：")]),e._v("点击"),a("i",{staticClass:"bf-icon bf-icon-xiazai icon"}),e._v("设置标记描述起点。"),a("br"),e._v(" "),a("b",[e._v("设置终点（快捷键：S）：")]),e._v("点击"),a("i",{staticClass:"bf-icon bf-icon-shangchuan icon"}),e._v("设置标记描述起点终点。"),a("br"),e._v(" "),a("b",[e._v("快进（快捷键：→）：")]),e._v("点击进度条或使用快捷键进行快进操作（5秒）。"),a("br"),e._v(" "),a("b",[e._v("快退（快捷键：←）：")]),e._v("点击进度条或使用快捷键进行快进操作（5秒）。"),a("br"),e._v(" "),a("b",[e._v("网页全屏（快捷键：W）：")]),e._v("点击"),a("i",{staticClass:"bf-icon bf-icon-mini icon"}),e._v("进入或退出网页全屏。"),a("br"),e._v(" "),a("b",[e._v("屏幕全屏（快捷键：F）：")]),e._v("点击"),a("i",{staticClass:"bf-icon bf-icon-fullscreen icon"}),e._v("进入或退出屏幕全屏"),a("b",[e._v("（屏幕全屏无法完成标记）")]),e._v("。"),a("br"),e._v(" "),a("b",[e._v("上一个：")]),e._v("点击"),a("i",{staticClass:"bf-icon bf-icon-previous icon"}),e._v("进入上一个标记项目。"),a("br"),e._v(" "),a("b",[e._v("下一个：")]),e._v("点击"),a("i",{staticClass:"bf-icon bf-icon-next icon"}),e._v("进入下一个标记项目。"),a("br"),e._v(" "),a("b",[e._v("保存：")]),e._v("点击"),a("i",{staticClass:"bf-icon bf-icon-save icon"}),e._v("保存描述列表。"),a("br"),e._v(" "),a("b",[e._v("审核确认：")]),e._v("点击"),a("i",{staticClass:"bf-icon bf-icon-wancheng icon"}),e._v("确认选中版本（仅在管理员/审核用户模式下）。"),a("br"),e._v(" "),a("b",[e._v("注意：删除操作也需要点击保存。")])])])}]};var k=a("VU/8")(y,_,!1,function(e){a("mGSw")},"data-v-e3bddd98",null).exports,w=a("suMn"),S={name:"task",props:["id","taskName","type"],data:function(){return{imglist:[],page:{now:1,total:1},account:this.global.account,loading:!1,imghost:s.a,labeledList:{},notice:{type:["分类","检测","分割","关键点","视频描述"],content:["选择一个或多个恰当的标签对图片进行分类。","只允许添加矩形框。","只允许添加多边形。","请按照给定的标签按顺序标记，按左边的‘下一个标签’按钮即可进入下一个标签标记。每个点都是有顺序的。","对视频进行打点，添加描述。"]},alert:{title:"",desc:""}}},watch:{id:function(){this.page.now=1,this.page.total=1,this.show()}},methods:{show:function(){var e=this;this.loading=!0,(5!=this.type?r(this.id,this.page.now):w.a.getVideoList(this.id,this.page.now)).then(function(t){e.labeledList=[];var a=!0,i=!1,n=void 0;try{for(var s,l=(5!=e.type?t.data.labelImageIds:t.data.labelVideoIds)[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var o=s.value;e.labeledList[o+""]=!0}}catch(e){i=!0,n=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw n}}e.imglist=5!=e.type?t.data.images:t.data.videos,e.page.total=t.data.totalpages}).catch(function(t){e.$alert("获取列表失败，"+t.message+"("+t.code+")。\r\n请重试","提示",{confirmButtonText:"确定",type:"warning"})}).then(function(){e.loading=!1})},pageChange:function(e){this.show()},goto:function(e,t){null!=e&&1==this.account.group?this.$alert("该标注已经锁定","提示",{confirmButtonText:"确定",type:"warning"}):this.$router.push(t)}},mounted:function(){this.alert.title=this.notice.type[this.type-1],this.alert.desc=this.notice.content[this.type-1],this.show()}},L={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-alert",{attrs:{title:e.alert.title,description:e.alert.desc,type:"info","close-text":"知道了"}}),e._v(" "),e.id?[a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"img-list"},e._l(e.imglist,function(t){return a("div",{key:5!=e.type?t.imageId:t.videoId,staticClass:"img-item",on:{click:function(a){return e.goto(t.userConfirmId,5!=e.type?"/img/"+t.imageId+"/"+e.id+"/"+e.type+"/"+e.taskName+"/"+e.page.now:"/video/"+t.videoId+"/"+e.id+"/"+e.taskName+"/"+e.page.now)}}},[a("el-card",{attrs:{shadow:"hover","body-style":{padding:"0px"}}},[a("el-image",{staticClass:"img-item-img",attrs:{lazy:!0,src:5!=e.type?e.imghost+"/api/thumb/"+e.taskName+"/"+t.imageThumb:e.imghost+"/api/videos/"+e.taskName+"/"+t.videoThumb,fit:"cover"}}),e._v(" "),a("div",{staticClass:"img-item-span"},[a("span",[e._v("\n              "+e._s(5!=e.type?t.imageName:t.videoName)+"\n              "),null!=t.userConfirmId?a("el-tag",{staticClass:"img-item-finish",attrs:{type:"success",size:"mini"}},[e._v("已审核")]):e._e(),e._v(" "),3!=e.account.group&&e.labeledList[5!=e.type?t.imageId:t.videoId+""]?a("el-tag",{staticClass:"img-item-labeled",attrs:{type:"primary",size:"mini"}},[e._v("\n                已标记\n              ")]):e._e()],1)])],1)],1)}),0),e._v(" "),e.page.total>1?a("el-pagination",{staticClass:"pagination",attrs:{background:"",layout:"prev, pager, next,jumper","page-count":e.page.total,"current-page":e.page.now},on:{"current-change":e.pageChange,"update:currentPage":function(t){return e.$set(e.page,"now",t)},"update:current-page":function(t){return e.$set(e.page,"now",t)}}}):e._e()]:a("h1",[e._v("Illegal task id! Please refresh this page.")])],2)},staticRenderFns:[]};var x=a("VU/8")(S,L,!1,function(e){a("GTkh")},"data-v-84406682",null).exports;var C={name:"label",props:["id","tid","type","taskName","imagePage"],data:function(){return{img:"",label:[],name:"",area:[],count:0,penddingUserList:[],isReviewer:!1,loading:!0,penddingUserSelectId:0,labelCore:void 0,penddingUserActive:"user",account:this.global.account,activeIndex:"",task:{page:+this.imagePage,total:0,id:this.tid,list:[],index:0,name:this.taskName},classify:{label:[],select:[],dialogVisible:!1},labelIndex:0}},watch:{id:function(){this.load(!0)}},methods:{classifyClick:function(){this.classify.label=[];var e=!0,t=!1,a=void 0;try{for(var i,n=this.label[Symbol.iterator]();!(e=(i=n.next()).done);e=!0){var s=i.value;this.classify.label.push({label:s.label,value:s.id})}}catch(e){t=!0,a=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw a}}this.classify.dialogVisible=!0},classifyAdd:function(){this.labelCore.clean();var e=!0,t=!1,a=void 0;try{for(var i,n=this.classify.select[Symbol.iterator]();!(e=(i=n.next()).done);e=!0){var s=i.value;this.labelCore.setClassify(s)}}catch(e){t=!0,a=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw a}}this.classify.dialogVisible=!1},load:function(e){1==this.account.group?this.getImgInfo(e):3==this.account.group||2==this.account.group?e?this.getImgInfo(e):this.getUserLabelList(e):this.$message({type:"error",message:"尚未登录"}),0==this.account.group||e||this.getImageList().then().catch()},getImgInfo:function(e){var t,a,i,n,l,o=this;this.loading=!0,(t=this.id,a=1==this.account.group?this.account.id:this.penddingUserSelectId,this.account,i=localStorage.getItem("group"),n=Object(s.g)(i),l={imageId:t},void 0!=a&&(l.userId=a),Object(s.e)("/api/"+n+"/getImg",l)).then(function(e){var t=s.a+"/api/image/"+o.taskName+"/"+e.data.image.imageName;o.img==t&&(o.loading=!1);var a=JSON.stringify(e.data.labels);a=a.replace(/labelId/g,"id").replace(/labelName/g,"label").replace(/labelType/g,"type").replace(/labelColor/g,"color"),o.label=JSON.parse(a),o.name=e.data.image.imageName,o.area=[],o.classify.select=[],o.labelIndex=0;var i="",n=!0,l=!1,r=void 0;try{for(var c,u=e.data.datas[Symbol.iterator]();!(n=(c=u.next()).done);n=!0){var d=c.value,f=[],p=!0,v=!1,m=void 0;try{for(var b,h=d.point[Symbol.iterator]();!(p=(b=h.next()).done);p=!0){var g=b.value;f.push([g.x,g.y])}}catch(e){v=!0,m=e}finally{try{!p&&h.return&&h.return()}finally{if(v)throw m}}o.area.push({labelId:d.labelId,labelType:d.labelType,desc:d.dataDesc,points:f,iscrowd:d.iscrowd}),1==o.type&&o.classify.select.push(d.labelId),i!=d.labelId&&(o.labelIndex++,i=d.labelId)}}catch(e){l=!0,r=e}finally{try{!n&&u.return&&u.return()}finally{if(l)throw r}}if(o.img==t)return o.labelCore.reload(o.area),void o.loadLabelIndex();o.img=t}).catch(function(e){o.loading=!1,o.$alert("获取图片信息失败，"+e.message+"("+e.code+")。\r\n请重试","提示",{confirmButtonText:"确定",type:"warning"})})},getUserLabelList:function(e){var t,a,i,n=this;(t=this.id,this.account,a=localStorage.getItem("group"),i=Object(s.g)(a),Object(s.e)("/api/"+i+"/getPendingUserList",{imageId:t})).then(function(t){var a=t.data;a.length>0?(n.activeIndex=a[0].userId+"",n.penddingUserSelectId=a[0].userId,n.getImgInfo(e),n.penddingUserList=a):n.$alert("该任务未分配用户标记","提示",{confirmButtonText:"确定",callback:function(e){n.$router.go(-1)}})}).catch(function(e){n.$message({type:"error",message:"获取用户标记列表失败，"+e.message+"("+e.code+")"})})},loadMark:function(){var e=this;if(""!=this.img){if(this.loading=!1,null!=this.labelCore)return this.labelCore.reload(this.area),void this.loadLabelIndex();this.labelCore=new function(e,t,a,i,n,s,l){var o=e.querySelector(".label-area"),r=e.querySelector(".label-popup"),c=e.querySelector(".label-main"),u=document.querySelector(".label-list .label-list-ul"),d=e.querySelector("canvas"),f=e.querySelector("img"),p=e.querySelector(".label-svg"),v=e.querySelector(".save"),m=e.querySelector(".confirm"),b={move:e.querySelector(".move"),select:e.querySelector(".select"),polygon:e.querySelector(".polygon"),rectangle:e.querySelector(".rectangle"),edit:e.querySelector(".edit"),delete:e.querySelector(".delete"),zoomin:e.querySelector(".zoomin"),zoomout:e.querySelector(".zoomout")},h={save:e.querySelector(".label-save-label"),delete:e.querySelector(".label-delete-label"),label:e.querySelector(".label-label"),crowd:e.querySelector(".label-crowd"),desc:e.querySelector(".label-desc")},g=function(e,t,a){return e+5>=a[0]&&e-5<=a[0]&&t+5>=a[1]&&t-5<=a[1]},y={mousedown:function(e){if(!V){var t=e.layerX/("Chrome"==R?q:1),a=e.layerY/("Chrome"==R?q:1);switch(console.log("Mousedown ("+t+","+a+")"),x){case 1:A=!0;break;case 2:_.addPoint(t,a,e.button,e.clientX,e.clientY);break;case 3:A=!0,V=!0,_.rectangleInit(t,a);break;case 4:j&&_.dragPoint(t,a,e.clientX,e.clientY);break;default:console.warn("Illegal mode!")}}},mouseup:function(e){if(A)if(A=!1,3==x)V=!1,k.addArea(e.clientX,e.clientY);else if(4==x){if(!U){var t=($[N][0]+$[N-1<0?$.length-1:N-1][0])/2,a=($[N][1]+$[N-1<0?$.length-1:N-1][1])/2;$.splice(N,0,[t,a,1]),t=($[N+1][0]+$[N+2>$.length-1?0:N+2][0])/2,a=($[N+1][1]+$[N+2>$.length-1?0:N+2][1])/2,$.splice(N+2,0,[t,a,1])}k.drawArea()}},mousemove:function(e){if(A){var t=e.layerX/("Chrome"==R?q:1),a=e.layerY/("Chrome"==R?q:1);switch(x){case 1:var i=o.scrollLeft-e.movementX,n=o.scrollTop-e.movementY;o.scrollTo({top:n<0?0:n,left:i<0?0:i});break;case 3:k.drawRectangle(t,a);break;case 4:0==U?($[N][0]=t,$[N][1]=a,k.drawArea()):k.drawRectangle(t,a,N)}}},wheel:function(e){1==x&&k.zoom(e.deltaY<0?.05:-.05)},clickbutton:function(t,a){if(V)alert("请先完成标签编辑任务");else{var i=this;if("number"==typeof t&&(i=a),i!=b.zoomin)if(i!=b.zoomout)if(0!=$.length&&(2!=O&&i==b.polygon||3!=O&&i==b.rectangle||4!=O&&i==b.edit||0!=O&&i==b.delete))alert("请先完成当前标记区域。\n添加模式下，在起点处按下左键完成标记，在起点处按下右键撤销标记\n修改模式下，点击空白处完成修改");else{switch(0==$.length&&(O=0),i){case b.select:x=0,j=4==O&&j;break;case b.move:x=1,j=4==O&&j;break;case b.polygon:x=2,O=2,j=!0;break;case b.rectangle:x=3,O=3,j=!0;break;case b.edit:j=4==O&&j;var n=[4,4,!1];x=n[0],O=n[1];break;case b.delete:x=5,j=!1}e.querySelector(".active").classList.remove("active"),i.querySelector("li").classList.add("active")}else k.zoom(-.15);else k.zoom(.15)}},savelabel:function(){k.createArea(h.label.value,h.desc.value,t[h.label.value].color,h.crowd.checked),r.style.display="none",V=!1,4==x&&(j=!1),e.focus()},deletelabel:function(){$=[],k.drawArea(),r.style.display="none",V=!1,4==x&&(j=!1),e.focus()},save:function(){i(E)},confirm:function(){n(E)},keydown:function(e){if(e.target!=h.desc)switch(e.key){case"a":case"A":y.clickbutton(1,b.select);break;case"w":case"W":y.clickbutton(1,b.move);break;case"q":case"Q":y.clickbutton(1,b.polygon);break;case"r":case"R":y.clickbutton(1,b.rectangle);break;case"e":case"E":y.clickbutton(1,b.edit);break;case"d":case"D":y.clickbutton(1,b.delete);break;case"z":case"Z":y.clickbutton(1,b.zoomin);break;case"x":case"X":y.clickbutton(1,b.zoomout);break;case"s":case"S":e.ctrlKey&&(y.save(),e.preventDefault());break;case"C":e.ctrlKey&&(y.confirm(),e.preventDefault())}}},_={addPoint:function(e,t,a,i,n){U=0,D=-1,0!=$.length&&g(e,t,$[0])?2==a?$=[]:k.addArea(i,n):$.push([e,t,0]),k.drawArea()},rectangleInit:function(e,t){U=1,D=-1;for(var a=0;a<4;a++)$.push([e,t,0]);N=2},dragPoint:function(e,t,a,i){var n=N;for(var s in N=-1,$)if(g(e,t,$[s])){N=parseInt(s);break}n>=0&&1==$[n][2]&&(N!=n&&N!=n+2?(-1!=N&&(N=N>n+1?N-2:N==n+1?n:N),$.splice(n+2,1),$.splice(n,1)):N==n?$.splice(n+2,1):($.splice(n,1),N--)),-1!=N?($[N][2]=0,A=!0):k.addArea(a,i)}},k={drawArea:function(e){if(P.clearRect(0,0,d.width,d.height),P.lineWidth=3,0!=$.length){var t=!1;P.beginPath(),P.strokeStyle="rgba(87, 95, 207,1.0)";var a=!0,i=!1,n=void 0;try{for(var s,l=$[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var o=s.value;t?P.lineTo(o[0],o[1]):(P.moveTo(o[0],o[1]),t=!0)}}catch(e){i=!0,n=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw n}}if((3==x||4==x||V)&&P.lineTo($[0][0],$[0][1]),P.stroke(),P.closePath(),P.fillStyle="white",P.strokeStyle="rgba(87, 95, 207,1.0)",4==x){var r=!0,c=!1,u=void 0;try{for(var f,p=$[Symbol.iterator]();!(r=(f=p.next()).done);r=!0){var v=f.value;P.beginPath(),P.ellipse(v[0],v[1],2,2,0,0,2*Math.PI),P.stroke(),P.fill(),P.closePath()}}catch(e){c=!0,u=e}finally{try{!r&&p.return&&p.return()}finally{if(c)throw u}}}else P.beginPath(),P.ellipse($[0][0],$[0][1],2,2,0,0,2*Math.PI),P.stroke(),P.fill(),P.closePath();e&&A&&(P.strokeStyle="#eee",P.lineWidth=1,P.beginPath(),P.moveTo(0,$[N][1]),P.lineTo(C,$[N][1]),P.stroke(),P.closePath(),P.beginPath(),P.moveTo($[N][0],0),P.lineTo($[N][0],I),P.stroke(),P.closePath())}},createArea:function(e,a,i,n,l){var o=[],r=!0,c=!1,u=void 0;try{for(var d,f=$[Symbol.iterator]();!(r=(d=f.next()).done);r=!0){var p=d.value;0==p[2]&&o.push(p)}}catch(e){c=!0,u=e}finally{try{!r&&f.return&&f.return()}finally{if(c)throw u}}E.push({id:t[e].id,index:e,desc:a,color:i,type:2==x||4==x&&0==U?0:1,points:o,iscrowd:n?1:0});var v="",m=!0,b=!1,g=void 0;try{for(var y,_=o[Symbol.iterator]();!(m=(y=_.next()).done);m=!0){var w=y.value;v+=w[0]+","+w[1]+" "}}catch(e){b=!0,g=e}finally{try{!m&&_.return&&_.return()}finally{if(b)throw g}}$=[],k.createSVGPath(v,i,i+"66"),k.drawArea(),h.desc.value="",h.crowd.checked=!1,s&&!l&&s()},addArea:function(e,t){V=!0,k.updateLabelSelector(U),r.style.display="inline",o.clientWidth<e+r.clientWidth+10?r.style.left=o.clientWidth-r.clientWidth-10+"px":r.style.left=e+"px",o.clientHeight<t+r.clientHeight+10?r.style.top=o.clientHeight-r.clientHeight-5+"px":r.style.top=t+"px",k.drawArea()},createSVGPath:function(e,t,a){var i=document.createElementNS("http://www.w3.org/2000/svg","polygon");i.setAttribute("points",e),i.setAttribute("stroke",t),i.setAttribute("stroke-width",3),i.setAttribute("fill","none");var n=E[E.length-1];i.setAttribute("label",n.id),i.addEventListener("mouseenter",function(){!j&&i.setAttribute("fill",a)}),i.addEventListener("click",function(){j||(5==x?k.removeAreaList(n,this):4==x&&(U=n.type,D=n.id,$=n.points,h.label.value=n.index,h.desc.value=n.desc,h.crowd.checked=n.iscrowd,k.drawArea(),k.removeAreaList(n,this),j=!0))}),i.addEventListener("mouseleave",function(){!j&&i.setAttribute("fill","none")}),p.appendChild(i),k.updateCount(n.id,!0)},removeAreaList:function(e,t){for(var a in E)if(E[a]==e){if(-1!=M&&e.index!=M-1)return void alert("请按照标记顺序删除");k.updateCount(e.id,!1),E.splice(a,1),t&&t.remove();break}var i=!0;if(-1!=M)for(var n in E)if(E[n].index==M-1){i=!1;break}l&&i&&l()},drawRectangle:function(e,t){var a=parseInt(N),i=2==a||0==a?0:1;$[a+1>3?0:a+1][i]=0==i?e:t,$[a][0]=e,$[a][1]=t,$[a-1<0?3:a-1][0==i?1:0]=0==i?t:e,k.drawArea(!0)},zoom:function(e){q+=e,c.style.transform="scale("+q+")"},updateCount:function(e,t){var a=document.querySelector(".label-list-count-"+e),i=parseInt(a.innerHTML);a.innerHTML=t?++i:--i},updateLabelSelector:function(e){h.label.innerHTML="";var a=0,i=0;for(var n in t){var s=t[n],l=document.createElement("option");l.value=n,l.innerHTML=s.label,l.style.color=s.color,h.label.appendChild(l),-1!=D&&s.id==D&&(i=a),a++}h.label.disabled=!1,0!=i?h.label.childNodes[i].selected=!0:-1!=M&&(h.label.childNodes[M].selected=!0,h.label.disabled=!0)}},w=function(){p.style.width=C+"px",p.style.height=I+"px",f.width=C,f.height=I,d.width=C,d.height=I,console.log(Math.abs(o.clientHeight*T-I)+"  "+Math.abs(o.clientWidth-C)),q=Math.abs(o.clientHeight*T-I)>Math.abs(o.clientWidth-C)?o.clientHeight/I:o.clientWidth/C,c.style.transform="scale("+q+")",S(),L()},S=function(){if(t){u.innerHTML="";var e=!0,a=!1,i=void 0;try{for(var n,s=t[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){var l=n.value,o=document.createElement("div");o.innerHTML='<li class="label-list-item">\n                <div style="background-color:'+l.color+'" class="label-list-color"></div>\n                <div class="label-list-title">\n                    <h3>'+l.label+"</h3>\n                    <p>"+l.color+'</p>\n                </div>\n                <div class="label-list-right">\n                    <span data-id="'+l.id+'" class="iconfont icon-kejian label-list-visible"></span>\n                    <div class="label-list-count label-list-count-'+l.id+'">0</div>\n                </div>\n            </li>',u.appendChild(o.childNodes[0])}}catch(e){a=!0,i=e}finally{try{!e&&s.return&&s.return()}finally{if(a)throw i}}var r=document.querySelectorAll(".label-list-visible"),c=!0,d=!1,f=void 0;try{for(var p,v=r[Symbol.iterator]();!(c=(p=v.next()).done);c=!0)p.value.addEventListener("click",function(){this.visible=!this.visible&&void 0!=this.visible;var e=document.querySelectorAll("[label='"+this.getAttribute("data-id")+"']"),t=!0,a=!1,i=void 0;try{for(var n,s=e[Symbol.iterator]();!(t=(n=s.next()).done);t=!0)n.value.style.display=this.visible?"inline":"none"}catch(e){a=!0,i=e}finally{try{!t&&s.return&&s.return()}finally{if(a)throw i}}this.classList.remove(this.visible?"icon-bukejian":"icon-kejian"),this.classList.add(this.visible?"icon-kejian":"icon-bukejian")})}catch(e){d=!0,f=e}finally{try{!c&&v.return&&v.return()}finally{if(d)throw f}}}},L=function(){if(a){var e=x;x=4;var i=!0,n=!1,s=void 0;try{for(var l,o=a[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var r=l.value;$=[];var c=!0,u=!1,d=void 0;try{for(var f,p=r.points[Symbol.iterator]();!(c=(f=p.next()).done);c=!0){var v=f.value;$.push([v[0],v[1],0])}}catch(e){u=!0,d=e}finally{try{!c&&p.return&&p.return()}finally{if(u)throw d}}for(var m in t)if(t[m].id==r.labelId){U=r.labelType,k.createArea(m,r.desc,t[m].color,r.iscrowd,!0);break}}}catch(e){n=!0,s=e}finally{try{!i&&o.return&&o.return()}finally{if(n)throw s}}x=e}},x=0,C=f.naturalWidth,I=f.naturalHeight,T=C/I,E=[],$=[],q=void 0,V=!1,A=!1,j=!0,O=0,N=-1,U=0,D=-1,R=-1!=navigator.userAgent.indexOf("Chrome")?"Chrome":"Firefox",M=-1,P=d.getContext("2d");for(var z in c.addEventListener("mousedown",y.mousedown),c.addEventListener("mouseup",y.mouseup),c.addEventListener("mousemove",y.mousemove),e.addEventListener("keydown",y.keydown),p.addEventListener("contextmenu",function(e){e.preventDefault()}),o.addEventListener("wheel",y.wheel),b)b[z].addEventListener("click",y.clickbutton);return h.save.addEventListener("click",y.savelabel),h.delete.addEventListener("click",y.deletelabel),v.addEventListener("click",y.save),m&&m.addEventListener("click",y.confirm),w(),{reload:function(e){C=f.naturalWidth,I=f.naturalHeight,E=[],p.innerHTML="",a=e,w()},setClassify:function(e){for(var a in($=[]).push([0,0,0]),t)if(t[a].id==e){U=0,k.createArea(a,"",t[a].color,!1);break}},clean:function(){for(var e=E.length;e--;)k.removeAreaList(E[0])},setLabelIndex:function(e){M=e}}}(document.querySelector(".label-core"),this.label,this.area,function(t){e.saveLabelArea(t)},function(t){e.$confirm("是否确定该版本为最终版本？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}).then(function(){e.setFinalVersion()}).catch(function(){})},function(){},function(){4==e.type&&(e.labelCore.setLabelIndex(--e.labelIndex),e.$message({type:"info",message:"你已经删除上一个标签的所有标记，现在请标记标签:'"+e.label[e.labelIndex].label+"'"}))}),this.loadLabelIndex()}},loadLabelIndex:function(){if(4==this.type){if(console.log(this.labelIndex),this.labelCore.setLabelIndex(this.labelIndex),this.labelIndex==this.label.length)return void this.$message({type:"success",message:"当前图片已经完成标注"});this.$message({type:"info",message:"现在请标记标签:'"+this.label[this.labelIndex].label+"'"})}},nextLabel:function(){if(this.labelCore.setLabelIndex(++this.labelIndex),this.labelIndex>=this.label.length)return this.labelIndex=this.label.length,void this.$message({type:"success",message:"已经完成当前图片标注，请点击保存结束标记"});this.$message({type:"info",message:"现在请标记标签:'"+this.label[this.labelIndex].label+"'"})},goBack:function(){var e=this;this.$confirm("未保存的进度将会丢失，确定返回？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.$router.push("/task/"+e.tid+"/"+e.taskName+"/"+e.type)}).catch(function(){})},penddingUserSelect:function(e){this.penddingUserSelectId=parseInt(e),this.getImgInfo(!0)},setFinalVersion:function(){var e,t,a,i,n=this;this.loading=!0,(e=parseInt(this.id),t=this.penddingUserSelectId,this.account,a=localStorage.getItem("group"),i=Object(s.g)(a),Object(s.e)("/api/"+i+"/setFinalVersion",{imageId:e,userConfirmId:t})).then(function(){n.$message({type:"success",message:"设置最终版本成功"})}).catch(function(e){n.$message({type:"error",message:"设置最终版本失败，"+e.message+"("+e.code+")"})}).then(function(){n.loading=!1})},saveLabelArea:function(e){var t=this;this.loading=!0;var a=[],i=!0,n=!1,l=void 0;try{for(var o,r=e[Symbol.iterator]();!(i=(o=r.next()).done);i=!0){var c=o.value,u=[],d=0,f=!0,p=!1,v=void 0;try{for(var m,b=c.points[Symbol.iterator]();!(f=(m=b.next()).done);f=!0){var h=m.value;u.push({x:h[0],y:h[1],order:++d})}}catch(e){p=!0,v=e}finally{try{!f&&b.return&&b.return()}finally{if(p)throw v}}a.push({labelId:c.id,labelType:c.type,dataDesc:c.desc,iscrowd:c.iscrowd,point:u})}}catch(e){n=!0,l=e}finally{try{!i&&r.return&&r.return()}finally{if(n)throw l}}(function(e,t,a){var i=localStorage.getItem("group"),n=Object(s.g)(i),l={imageId:e,data:t};return void 0!=a&&(l.userId=a),Object(s.e)("/api/"+n+"/saveLabel",l)})(this.id,a,1==this.account.group?this.account.id:this.penddingUserSelectId,this.account).then(function(){t.$message({type:"success",message:"保存成功"})}).catch(function(e){t.$message({type:"error",message:"保存失败，"+e.message+"("+e.code+")"})}).then(function(){t.loading=!1})},getImageList:function(e){var t=this;return new Promise(function(a,i){console.log(t.task.page),r(t.task.id,t.task.page).then(function(i){var n=i.data.images;if(t.task.list=n,t.task.total=i.data.totalpages,!e)for(var s=0;s<n.length;s++)n[s].imageId==t.id&&(t.task.index=s);a()}).catch(function(){t.$message({type:"error",message:"获取列表失败"}),i()})})},next:function(){var e=this,t=this.task;if(t.list.length-1==t.index){if(t.page==t.total)return void this.$message({type:"warning",message:"已经是最后一张"});t.page++,this.getImgInfo(!0).then(function(){t.index=0,e.$router.push("/img/"+t.list[t.index].imageId+"/"+t.id+"/"+e.type+"/"+t.name+"/"+t.page)})}else console.log(t.list),++t.index,this.$router.push("/img/"+t.list[t.index].imageId+"/"+t.id+"/"+this.type+"/"+t.name+"/"+t.page)},previous:function(){var e=this,t=this.task;if(0==t.index){if(1==t.page)return void this.$message({type:"warning",message:"已经是第一张"});t.page--,this.getImgInfo(!0).then(function(){t.index=t.list.length-1,e.$router.push("/img/"+t.list[t.index].imageId+"/"+t.id+"/"+e.type+"/"+t.name+"/"+t.page)})}else--t.index,this.$router.push("/img/"+t.list[t.index].imageId+"/"+t.id+"/"+this.type+"/"+t.name+"/"+t.page)}},mounted:function(){this.load()}},I={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%",height:"100%"}},[a("el-page-header",{staticClass:"page-header",attrs:{content:"标记"},on:{back:e.goBack}}),e._v(" "),a("div",{staticClass:"label-core",attrs:{tabindex:"1"}},[a("div",{staticClass:"label-toolbar"},[a("ul",[e._m(0),e._v(" "),e._m(1),e._v(" "),a("a",{staticClass:"polygon",style:{display:3==e.type||4==e.type&&this.labelIndex!=this.label.length?"block":"none"},attrs:{title:"添加多边形区域(Q)",href:"javascript:void(0)"}},[e._m(2)]),e._v(" "),a("a",{staticClass:"rectangle",style:{display:2==e.type||4==e.type&&this.labelIndex!=this.label.length?"block":"none"},attrs:{title:"添加正方形区域(R)",href:"javascript:void(0)"}},[e._m(3)]),e._v(" "),a("div",{staticClass:"label-divider"}),e._v(" "),a("a",{staticClass:"edit",style:{display:1!=e.type&&4!=e.type?"block":"none"},attrs:{title:"重新编辑区域(E)",href:"javascript:void(0)"}},[e._m(4)]),e._v(" "),1==e.type?a("a",{staticClass:"classify",attrs:{title:"添加分类标签",href:"javascript:void(0)"},on:{click:e.classifyClick}},[e._m(5)]):e._e(),e._v(" "),4==e.type?a("a",{staticClass:"classify",attrs:{title:"下一个标签",href:"javascript:void(0)"},on:{click:e.nextLabel}},[e._m(6)]):e._e(),e._v(" "),a("a",{staticClass:"delete",style:{display:1!=e.type?"block":"none"},attrs:{title:"删除区域(D)",href:"javascript:void(0)"}},[e._m(7)]),e._v(" "),a("div",{staticClass:"label-divider"}),e._v(" "),e._m(8),e._v(" "),e._m(9),e._v(" "),a("div",{staticClass:"label-divider"}),e._v(" "),e._m(10),e._v(" "),a("a",{staticClass:"confirm",style:{display:2==e.account.group||3==e.account.group?"block":"none"},attrs:{title:"确认该版本(Ctrl+C)",href:"javascript:void(0)"}},[e._m(11)]),e._v(" "),a("div",{staticClass:"label-divider"}),e._v(" "),a("a",{staticClass:"zoomin",attrs:{title:"上一个",href:"javascript:void(0)"},on:{click:e.previous}},[e._m(12)]),e._v(" "),a("a",{staticClass:"zoomout",attrs:{title:"下一个",href:"javascript:void(0)"},on:{click:e.next}},[e._m(13)])])]),e._v(" "),a("div",{staticClass:"label-area"},[a("div",{staticClass:"label-main"},[a("img",{attrs:{src:e.img,alt:"",srcset:""},on:{load:e.loadMark}}),e._v(" "),a("canvas"),e._v(" "),a("svg",{staticClass:"label-svg",attrs:{xmlns:"http://www.w3.org/2000/svg",version:"1.1"}})])]),e._v(" "),e._m(14),e._v(" "),a("div",{staticClass:"label-list"},[a("el-collapse",{staticClass:"label-user",style:{display:1!=e.account.group?"block":"none"},model:{value:e.penddingUserActive,callback:function(t){e.penddingUserActive=t},expression:"penddingUserActive"}},[a("el-collapse-item",{staticClass:"label-user-item",attrs:{title:"待审核用户列表",name:"user"}},[a("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{"default-active":e.activeIndex},on:{select:e.penddingUserSelect}},e._l(e.penddingUserList,function(t){return a("el-menu-item",{key:t.userId,attrs:{index:t.userId+""}},[a("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(t.username))])])}),1)],1)],1),e._v(" "),a("ul",{staticClass:"label-list-ul"})],1)]),e._v(" "),a("el-dialog",{attrs:{title:"添加分类标签",visible:e.classify.dialogVisible,width:"30%"},on:{"update:visible":function(t){return e.$set(e.classify,"dialogVisible",t)}}},[a("el-form",{attrs:{inline:!0}},[a("el-form-item",{attrs:{label:"标签",prop:"group"}},[a("el-select",{staticStyle:{"margin-left":"20px"},attrs:{multiple:"","collapse-tags":"",placeholder:"请选择标签"},model:{value:e.classify.select,callback:function(t){e.$set(e.classify,"select",t)},expression:"classify.select"}},e._l(e.classify.label,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.classify.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.classifyAdd}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("a",{staticClass:"select",attrs:{title:"选择(A)",href:"javascript:void(0)"}},[t("li",{staticClass:"active"},[t("span",{staticClass:"iconfont icon-zhizhen"})])])},function(){var e=this.$createElement,t=this._self._c||e;return t("a",{staticClass:"move",attrs:{title:"移动/缩放(W)",href:"javascript:void(0)"}},[t("li",[t("span",{staticClass:"iconfont icon-yidong"})])])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[t("span",{staticClass:"iconfont icon-duobianxing"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[t("span",{staticClass:"iconfont icon-kuangxuanquyu"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[t("span",{staticClass:"iconfont icon-sheji"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[t("span",{staticClass:"iconfont icon-sheji"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[t("span",{staticClass:"iconfont icon-nextweek"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[t("span",{staticClass:"iconfont icon-shanchu"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("a",{staticClass:"zoomin",attrs:{title:"放大(Z)",href:"javascript:void(0)"}},[t("li",[t("span",{staticClass:"iconfont icon-fangda"})])])},function(){var e=this.$createElement,t=this._self._c||e;return t("a",{staticClass:"zoomout",attrs:{title:"缩小(X)",href:"javascript:void(0)"}},[t("li",[t("span",{staticClass:"iconfont icon-suoxiao"})])])},function(){var e=this.$createElement,t=this._self._c||e;return t("a",{staticClass:"save",attrs:{title:"保存(Ctrl+S)",href:"javascript:void(0)"}},[t("li",[t("span",{staticClass:"iconfont icon-baocun"})])])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[t("span",{staticClass:"iconfont icon-dui"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[t("span",{staticClass:"iconfont icon-ai10"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("li",[t("span",{staticClass:"iconfont icon-ai09"})])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"label-popup",staticStyle:{display:"none"}},[a("select",{staticClass:"label-label"}),e._v(" "),a("div",{staticClass:"label-checkbox"},[a("input",{staticClass:"label-crowd",attrs:{type:"checkbox",value:"iscrowd"}}),e._v(" "),a("label",{attrs:{for:"iscrowd"}},[e._v("使用RLE格式")])]),e._v(" "),a("textarea",{staticClass:"label-desc",attrs:{rows:"5",placeholder:"描述"}}),e._v(" "),a("button",{staticClass:"label-save-label",attrs:{type:"button"}},[e._v("保存")]),e._v(" "),a("button",{staticClass:"label-delete-label",attrs:{type:"button"}},[e._v("删除")])])}]};var T=a("VU/8")(C,I,!1,function(e){a("+wL7")},null,null).exports,E=a("NHiN"),$={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%",height:"100%"}},[a("el-page-header",{staticClass:"page-header",attrs:{content:"视频标记"},on:{back:e.goBack}}),e._v(" "),a("div",{staticClass:"label-video"},[a("div",{staticClass:"bfplayer",attrs:{tabindex:"0"}},[a("div",{staticClass:"bf-loading",staticStyle:{display:"none"}}),e._v(" "),e._m(0),e._v(" "),a("div",{staticClass:"bf-capture"},[e._m(1),e._v(" "),e._m(2),e._v(" "),e._m(3),e._v(" "),a("div",{staticClass:"bf-btn bf-tooltip bf-tooltip-left",style:{display:2==e.account.group||3==e.account.group?"block":"none"},attrs:{role:"buttom","data-tooltip":"确认最终版本"},on:{click:e.setFinalVersion}},[a("span",{staticClass:"bf-icon bf-icon-wancheng"})])]),e._v(" "),e._m(4),e._v(" "),e._m(5)]),e._v(" "),a("div",{staticClass:"label-right"},[a("div",{staticClass:"label-list"},[a("el-collapse",{staticClass:"label-user",style:{display:1!=e.account.group?"block":"none"},model:{value:e.penddingUserActive,callback:function(t){e.penddingUserActive=t},expression:"penddingUserActive"}},[a("el-collapse-item",{staticClass:"label-user-item",attrs:{title:"待审核用户列表",name:"user"}},[a("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{"default-active":e.activeIndex},on:{select:e.penddingUserSelect}},e._l(e.penddingUserList,function(t){return a("el-menu-item",{key:t.userId,attrs:{index:t.userId+""}},[a("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(t.username))])])}),1)],1)],1),e._v(" "),a("ul",{staticClass:"label-list-ul"})],1)]),e._v(" "),e._m(6)])],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"bf-main"},[t("div",{staticClass:"bf-loading-panel"},[t("div",{staticClass:"bf-loading"},[t("div",{staticClass:"bf-ball bf-ball-1"}),this._v(" "),t("div",{staticClass:"bf-ball bf-ball-2"}),this._v(" "),t("div",{staticClass:"bf-ball bf-ball-3"}),this._v(" "),t("div",{staticClass:"bf-ball bf-ball-4"}),this._v(" "),t("div",{staticClass:"bf-ball bf-ball-5"})])]),this._v(" "),t("video",{staticClass:"bf-video",attrs:{src:""}})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"bf-btn bf-btn-start bf-tooltip bf-tooltip-left",attrs:{role:"buttom","data-tooltip":"设置起点"}},[t("span",{staticClass:"bf-icon bf-icon-xiazai"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"bf-btn bf-btn-end bf-tooltip bf-tooltip-left",attrs:{role:"buttom","data-tooltip":"设置终点"}},[t("span",{staticClass:"bf-icon bf-icon-shangchuan"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"bf-btn bf-btn-save bf-tooltip bf-tooltip-left",attrs:{role:"buttom","data-tooltip":"保存标记"}},[t("span",{staticClass:"bf-icon bf-icon-save"})])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"bf-menu",staticStyle:{display:"none",left:"0",top:"0"}},[t("ul",[t("li",[t("div",[this._v("\n              BFPlayer-Core By q6q64399\n            ")])]),this._v(" "),t("li",[t("div",[this._v("\n              1.1.055 (2019/10/13 22:53:25)\n            ")])])])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"bf-controller"},[a("div",{staticClass:"bf-pgb-player"},[a("div",{staticClass:"bf-pgb-point",staticStyle:{display:"none"}},[a("div")]),e._v(" "),a("div",{staticClass:"bf-pgb-buffer"}),e._v(" "),a("div",{staticClass:"bf-pgb-played"}),e._v(" "),a("div",{staticClass:"bf-pgb-select"})]),e._v(" "),a("div",{staticClass:"bf-top"},[a("div",{staticClass:"bf-btn bf-btn-play",attrs:{role:"buttom"}},[a("span",{staticClass:"bf-icon bf-icon-play"})]),e._v(" "),a("div",{staticClass:"bf-btn bf-btn-previous bf-tooltip",attrs:{role:"buttom","data-tooltip":"上一个"}},[a("span",{staticClass:"bf-icon bf-icon-previous"})]),e._v(" "),a("div",{staticClass:"bf-btn bf-btn-next bf-tooltip",attrs:{role:"buttom","data-tooltip":"下一个"}},[a("span",{staticClass:"bf-icon bf-icon-next"})]),e._v(" "),a("div",{staticClass:"bf-btn bf-btn-volume",attrs:{role:"buttom"}},[a("span",{staticClass:"bf-icon bf-icon-volumeup"})]),e._v(" "),a("div",{staticClass:"bf-volume-area",staticStyle:{display:"none"}},[a("div",{staticClass:"bf-volume"},[a("div",{staticClass:"bf-volume-value",staticStyle:{width:"100%"}}),e._v(" "),a("div",{staticClass:"bf-volume-point",staticStyle:{left:"100%"}})])]),e._v(" "),a("span",{staticClass:"bf-label-time"},[e._v("0:00 / 0:00")]),e._v(" "),a("span",{staticClass:"bf-label-select-time",staticStyle:{display:"none"}},[e._v("已选择：dd - dd")]),e._v(" "),a("div",{staticClass:"bf-spacer"}),e._v(" "),a("div",{staticClass:"bf-selector bf-selector-quality",attrs:{"data-selector-event":"changeRate","data-selector":'[{"name":"0.5x","value":"0.5"},{"name":"0.75x","value":"0.75"},{"name":"1x","value":"1","active":1},{"name":"1.25x","value":"1.25"},{"name":"1.5x","value":"1.5"},{"name":"2x","value":"2"}]'}},[e._v("\n            倍速\n          ")]),e._v(" "),a("div",{staticClass:"bf-btn bf-btn-fullbrowser bf-tooltip",attrs:{role:"buttom","data-tooltip":"网页全屏"}},[a("span",{staticClass:"bf-icon bf-icon-mini"})]),e._v(" "),a("div",{staticClass:"bf-btn bf-btn-fullscreen bf-tooltip",attrs:{role:"buttom","data-tooltip":"屏幕全屏"}},[a("span",{staticClass:"bf-icon bf-icon-fullscreen"})])])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"label-sign",staticStyle:{display:"none"}},[t("div",{staticClass:"label-sign-question"},[this._v("\n        添加描述\n      ")]),this._v(" "),t("div",{staticClass:"label-sign-answer"},[t("select",{staticClass:"label-sign-selector",staticStyle:{display:"none"}}),this._v(" "),t("textarea",{staticClass:"label-sign-text"})]),this._v(" "),t("div",{staticClass:"label-sign-bottom"},[t("button",{staticClass:"label-sign-btn label-sign-submit",attrs:{type:"button"}},[this._v("保存")]),this._v(" "),t("button",{staticClass:"label-sign-btn label-sign-cancel",attrs:{type:"button"}},[this._v("取消")])])])}]};var q=function(e){a("cvqD"),a("TLgD")},V=a("VU/8")(E.a,$,!1,q,null,null).exports,A={name:"Labelset",data:function(){return{form:{question:"",type:1,selector:""},rules:{question:[{required:!0,message:"请选择预设描述",trigger:"change"}],type:[{required:!0,message:"请选择类型",trigger:"blur"}],selector:[{required:!0,message:"请输入选择项",trigger:"change"}]},labelData:[],dialogVisible:!1,editId:0,type:"add",loading:!1,account:this.global.account,search:"",tempLabelData:[]}},watch:{search:function(){var e=this.search.toLowerCase();if(""!=e){var t=this.tempLabelData.filter(function(t){return null!=t.question&&-1!=t.question.toLowerCase().indexOf(e)});this.labelData=t}else this.labelData=this.tempLabelData}},methods:{showList:function(){var e=this;this.search="",this.loading=!0,w.a.getLabelList().then(function(t){e.labelData=t.data,e.tempLabelData=t.data}).catch(function(t){e.$message({type:"error",message:"获取标签列表失败,"+t.message+"("+t.code+")"})}).then(function(){e.loading=!1})},addLabelBtn:function(){this.type="add",this.dialogVisible=!0,this.form={question:"",type:1,selector:""}},editLabel:function(e){this.type="edit",this.editId=e.labelId,this.form.question=e.question,this.form.type=e.type,this.form.selector=this.parserSelector(e.selector),this.dialogVisible=!0},deleteLabel:function(e){var t=this;this.loading=!0,w.a.deleteLabel(e.labelId,this.account).then(function(){t.$message({type:"success",message:'删除标签"'+e.question+'"成功'})}).catch(function(a){t.$message({type:"error",message:'删除标签"'+e.question+'"失败,'+a.message+"("+a.code+")"})}).then(function(){t.loading=!1}),this.showList()},addLabel:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;e.loading=!0,("add"==e.type?w.a.addLabel(e.form.type,e.form.question,e.parserSelector(e.form.selector,!0)):w.a.editLabel(e.editId,e.form.type,e.form.question,e.parserSelector(e.form.selector,!0))).then(function(){e.$message({type:"success",message:("add"==e.type?"添加":"修改")+"标签成功"})}).catch(function(t){e.$message({type:"error",message:("add"==e.type?"添加":"修改")+"标签失败,"+t.message+"("+t.code+")"})}).then(function(){e.dialogVisible=!1,e.loading=!1,e.showList()})})},parserSelector:function(e,t){if(t)return e.split(",");if(console.log(e),""==e)return null;for(var a="",i=0;i<e.length;i++)a+=e[i]+(i!=e.length-1?",":"");return a}},mounted:function(){this.showList()}},j={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},on:{click:e.addLabelBtn}},[e._v("添加标签")]),e._v(" "),a("el-button",{attrs:{icon:"el-icon-refresh-left"},on:{click:e.showList}},[e._v("刷新列表")]),e._v(" "),a("el-input",{staticClass:"search",attrs:{"prefix-icon":"el-icon-search",placeholder:"搜索标签"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"10px"},attrs:{border:"",data:e.labelData,stripe:""}},[a("el-table-column",{attrs:{prop:"type",label:"类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(0==t.row.type?"空白":1==t.row.type?"填空":"选择"))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"question","min-width":"100",label:"预设描述"}}),e._v(" "),a("el-table-column",{attrs:{prop:"selector",label:"选择项"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(null==t.row.selector?"无":e.parserSelector(t.row.selector)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[0!=t.row.type?a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.editLabel(t.row)}}},[e._v("编辑")]):e._e(),e._v(" "),0!=t.row.type?a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return e.deleteLabel(t.row)}}},[e._v("删除")]):e._e()]}}])})],1),e._v(" "),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{title:"添加/编辑标签",visible:e.dialogVisible,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"form",attrs:{rules:e.rules,"hide-required-asterisk":!0,model:e.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"类型",prop:"type"}},[a("el-select",{attrs:{placeholder:"请选择类型"},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},[a("el-option",{attrs:{label:"填空",value:1}}),e._v(" "),a("el-option",{attrs:{label:"选择",value:2}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"预设描述",prop:"question"}},[a("el-input",{attrs:{placeholder:"预设描述，用'$'代表空格项"},model:{value:e.form.question,callback:function(t){e.$set(e.form,"question",t)},expression:"form.question"}})],1),e._v(" "),2==e.form.type?a("el-form-item",{attrs:{label:"选择项",prop:"selector"}},[a("el-input",{attrs:{placeholder:"输入选择项，用','分割"},model:{value:e.form.selector,callback:function(t){e.$set(e.form,"selector",t)},expression:"form.selector"}})],1):e._e()],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.addLabel}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var O=a("VU/8")(A,j,!1,function(e){a("S4Wm")},"data-v-7c078a7c",null).exports;var N={data:function(){return{dialogVisible:!1,type:"add",editId:0,userData:[],tempUserData:[],form:{username:"",password:"",group:""},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],group:[{required:!0,message:"请选择用户组",trigger:"change"}]},loading:!1,account:this.global.account,search:""}},watch:{search:function(){var e=this.search.toLowerCase();if(""!=e){var t=this.tempUserData.filter(function(t){return-1!=t.username.toLowerCase().indexOf(e)});this.userData=t}else this.userData=this.tempUserData}},methods:{editUser:function(e){var t=[e.username,e.password,e.authorities];this.form.username=t[0],this.form.password=t[1],this.form.group=t[2];var a=[!0,"edit",e.userId];this.dialogVisible=a[0],this.type=a[1],this.editId=a[2]},deleteUser:function(e){var t,a=this;(t=e.userId,this.account,Object(s.e)("/api/admin/deleteUser",{userId:t})).then(function(){a.$message({type:"success",message:"删除用户成功"}),a.showList()}).catch(function(e){a.$message({type:"error",message:"删除用户失败,"+e.message+"("+e.code+")"})})},filterTag:function(e,t){return t.authorities==e},addUser:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;var a,i,n,l;e.dialogVisible=!1,e.loading=!0,(a=e.form.username,i=e.form.password,n=e.form.group,l="add"==e.type?void 0:e.editId,e.account,l?Object(s.e)("/api/admin/editUser",{userId:l,username:a,password:i,authorities:n}):Object(s.e)("/api/admin/addUser",{username:a,password:i,authorities:n})).then(function(t){e.$message({type:"success",message:("add"==e.type?"添加":"修改")+"新用户成功"});var a=["","",""];e.form.username=a[0],e.form.password=a[1],e.form.group=a[2]}).catch(function(t){e.$message({type:"error",message:("add"==e.type?"添加":"修改")+"用户失败,"+t.message+"("+t.code+")"})}).then(function(){e.loading=!1,e.showList()})})},addUserBtn:function(){var e=["","",""];this.form.username=e[0],this.form.password=e[1],this.form.group=e[2];var t=[!0,"add"];this.dialogVisible=t[0],this.type=t[1]},showList:function(){var e=this;this.loading=!0,(this.account,Object(s.c)("/api/admin/getUserList")).then(function(t){e.userData=t.data.userList,e.tempUserData=t.data.userList}).catch(function(t){e.$message({type:"error",message:"获取用户列表失败,"+t.message+"("+t.code+")"})}).then(function(){e.loading=!1})}},mounted:function(){this.showList()}},U={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},on:{click:e.addUserBtn}},[e._v("添加用户")]),e._v(" "),a("el-button",{attrs:{icon:"el-icon-refresh-left"},on:{click:e.showList}},[e._v("刷新列表")]),e._v(" "),a("el-input",{staticClass:"search",attrs:{"prefix-icon":"el-icon-search",placeholder:"搜索用户"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"10px"},attrs:{border:"",data:e.userData,stripe:""}},[a("el-table-column",{attrs:{prop:"username","min-width":"100",label:"用户名"}}),e._v(" "),a("el-table-column",{attrs:{prop:"password","min-width":"100",label:"密码"}}),e._v(" "),a("el-table-column",{attrs:{filters:[{text:"用户",value:"ROLE_USER"},{text:"审核",value:"ROLE_REVIEWER"},{text:"管理",value:"ROLE_ADMIN"}],"filter-method":e.filterTag,"filter-placement":"bottom-end",prop:"authorities",label:"用户组别",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:"ROLE_USER"==t.row.authorities?"primary":"success","disable-transitions":""}},[e._v(e._s("ROLE_USER"==t.row.authorities?"用户":"ROLE_REVIEWER"==t.row.authorities?"审核":"管理"))])]}}])}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return["ROLE_ADMIN"!=t.row.authorities?a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.editUser(t.row)}}},[e._v("编辑")]):e._e(),e._v(" "),"ROLE_ADMIN"!=t.row.authorities?a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return e.deleteUser(t.row)}}},[e._v("删除")]):e._e()]}}])})],1),e._v(" "),a("el-dialog",{attrs:{title:"添加用户",visible:e.dialogVisible,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"form",attrs:{rules:e.rules,"hide-required-asterisk":!0,model:e.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"用户名",prop:"username"}},[a("el-input",{attrs:{placeholder:"用户名"},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"密码",prop:"password"}},[a("el-input",{attrs:{placeholder:"密码","show-password":""},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"用户组",prop:"group"}},[a("el-select",{attrs:{placeholder:"请选择用户组"},model:{value:e.form.group,callback:function(t){e.$set(e.form,"group",t)},expression:"form.group"}},[a("el-option",{attrs:{label:"用户",value:"ROLE_USER"}}),e._v(" "),a("el-option",{attrs:{label:"审核",value:"ROLE_REVIEWER"}})],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.addUser}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var D=a("VU/8")(N,U,!1,function(e){a("qlky")},"data-v-1aed239e",null).exports;var R={name:"Labelset",data:function(){return{form:{label:"",color:"#3498db"},defaultColor:["#1abc9c","#2ecc71","#3498db","#9b59b6","#34495e","#f1c40f","#e67e22","#e74c3c","#95a5a6"],rules:{label:[{required:!0,message:"请输入名称",trigger:"blur"}],type:[{required:!0,message:"请选择标签类型",trigger:"change"}],color:[{required:!0,message:"请选择一个颜色",trigger:"change"}]},labelData:[],dialogVisible:!1,editId:0,type:"add",loading:!1,account:this.global.account,search:"",tempLabelData:[]}},watch:{search:function(){var e=this.search.toLowerCase();if(""!=e){var t=this.tempLabelData.filter(function(t){return-1!=t.labelName.toLowerCase().indexOf(e)});this.labelData=t}else this.labelData=this.tempLabelData}},methods:{showList:function(){var e=this;this.search="",this.loading=!0,(this.account,Object(s.c)("/api/admin/getLabelList")).then(function(t){e.labelData=t.data.labelList,e.tempLabelData=t.data.labelList}).catch(function(t){e.$message({type:"error",message:"获取标签列表失败,"+t.message+"("+t.code+")"})}).then(function(){e.loading=!1})},addLabelBtn:function(){this.type="add",this.dialogVisible=!0,this.form.label="",this.form.color="#3498db"},editLabel:function(e){this.type="edit",this.editId=e.labelId,this.form.label=e.labelName,this.form.color=e.labelColor,this.dialogVisible=!0},deleteLabel:function(e){var t,a=this;this.loading=!0,(t=e.labelId,this.account,Object(s.e)("/api/admin/deleteLabel",{labelId:t})).then(function(){a.$message({type:"success",message:'删除标签"'+e.labelName+'"成功'})}).catch(function(t){a.$message({type:"error",message:'删除标签"'+e.labelName+'"失败,'+t.message+"("+t.code+")"})}).then(function(){a.loading=!1}),this.showList()},addLabel:function(){var e=this;this.$refs.form.validate(function(t){if(!t)return!1;var a,i,n;e.loading=!0,("add"==e.type?(a=e.form.label,i=0,n=e.form.color,e.account,Object(s.e)("/api/admin/addLabel",{labelName:a,labelType:i,labelColor:n})):function(e,t,a,i){return Object(s.e)("/api/admin/editLabel",{labelId:e,labelName:t,labelType:a,labelColor:i})}(e.editId,e.form.label,0,e.form.color,e.account)).then(function(){e.$message({type:"success",message:("add"==e.type?"添加":"修改")+"标签成功"})}).catch(function(t){e.$message({type:"error",message:("add"==e.type?"添加":"修改")+"标签失败,"+t.message+"("+t.code+")"})}).then(function(){e.dialogVisible=!1,e.loading=!1,e.showList()})})}},mounted:function(){this.showList()}},M={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},on:{click:e.addLabelBtn}},[e._v("添加标签")]),e._v(" "),a("el-button",{attrs:{icon:"el-icon-refresh-left"},on:{click:e.showList}},[e._v("刷新列表")]),e._v(" "),a("el-input",{staticClass:"search",attrs:{"prefix-icon":"el-icon-search",placeholder:"搜索标签"},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"10px"},attrs:{border:"",data:e.labelData,stripe:""}},[a("el-table-column",{attrs:{prop:"labelName","min-width":"100",label:"名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"labelColor",label:"颜色"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"label-color",style:"background-color:"+t.row.labelColor}),e._v(" "),a("span",[e._v(e._s(t.row.labelColor))])]}}])}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.editLabel(t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return e.deleteLabel(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{title:"添加/编辑标签",visible:e.dialogVisible,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"form",attrs:{rules:e.rules,"hide-required-asterisk":!0,model:e.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"标签名称",prop:"label"}},[a("el-input",{attrs:{placeholder:"标签名称"},model:{value:e.form.label,callback:function(t){e.$set(e.form,"label",t)},expression:"form.label"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"颜色",prop:"color"}},[a("el-color-picker",{attrs:{"color-format":"hex",predefine:e.defaultColor},model:{value:e.form.color,callback:function(t){e.$set(e.form,"color",t)},expression:"form.color"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.addLabel}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var P=a("VU/8")(R,M,!1,function(e){a("/24z")},"data-v-05973b02",null).exports;function z(e,t,a,i,n){return Object(s.e)("/api/admin/updateTask",{taskId:e,taskName:t,userIds:a,labelIds:i,reviewerIds:n,taskDesc:""})}var F={getTaskList:function(e){var t={page:e||1,limit:30};return Object(s.e)("/api/admin/getTaskList",t)},getLabelList:function(e,t){console.log("TaskType:"+e);var a={},i=!0,n=!1,l=void 0;try{for(var o,r=t[Symbol.iterator]();!(i=(o=r.next()).done);i=!0){var c=o.value;a[c+""]=!0}}catch(e){n=!0,l=e}finally{try{!i&&r.return&&r.return()}finally{if(n)throw l}}return new Promise(function(t,i){(5!=e?Object(s.c)("/api/admin/getLabelList"):Object(s.c)("/api/admin/getVideoLabelList")).then(function(i){var n=5!=e?i.data.labelList:i.data,s=[],l=!0,o=!1,r=void 0;try{for(var c,u=n[Symbol.iterator]();!(l=(c=u.next()).done);l=!0){var d=c.value;5!=e?s.push({labelId:d.labelId,labelName:d.labelName,join:1==a[d.labelId+""]}):s.push({labelId:d.labelId,question:d.question,type:d.type,join:1==a[d.labelId+""]})}}catch(e){o=!0,r=e}finally{try{!l&&u.return&&u.return()}finally{if(o)throw r}}t(s)}).catch(function(e){i(e)})})},getList:function(e,t){var a=e.taskId,i={};console.log(e);var n=!0,l=!1,o=void 0;try{for(var r,c=("User"==t?e.userIds:e.reviewerIds)[Symbol.iterator]();!(n=(r=c.next()).done);n=!0){var u=r.value;i[u+""]=!0}}catch(e){l=!0,o=e}finally{try{!n&&c.return&&c.return()}finally{if(l)throw o}}return new Promise(function(e,n){Object(s.e)("/api/admin/getList"+t,{taskId:a}).then(function(t){var a=[],n=!0,s=!1,l=void 0;try{for(var o,r=t.data[Symbol.iterator]();!(n=(o=r.next()).done);n=!0){var c=o.value;a.push({userId:c.userId,username:c.username,join:1==i[c.userId]})}}catch(e){s=!0,l=e}finally{try{!n&&r.return&&r.return()}finally{if(s)throw l}}e(a)}).catch(function(e){n(e)})})},setReviewer:function(e,t){var a=[],i=!0,n=!1,s=void 0;try{for(var l,o=t[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var r=l.value;a.push(r.userId)}}catch(e){n=!0,s=e}finally{try{!i&&o.return&&o.return()}finally{if(n)throw s}}return z(e.taskId,e.taskName,e.userIds,e.labelIds,a)},setUser:function(e,t){var a=[],i=!0,n=!1,s=void 0;try{for(var l,o=t[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var r=l.value;a.push(r.userId)}}catch(e){n=!0,s=e}finally{try{!i&&o.return&&o.return()}finally{if(n)throw s}}return z(e.taskId,e.taskName,a,e.labelIds,e.reviewerIds)},setLabel:function(e,t){var a=[],i=!0,n=!1,s=void 0;try{for(var l,o=t[Symbol.iterator]();!(i=(l=o.next()).done);i=!0){var r=l.value;a.push(r.labelId)}}catch(e){n=!0,s=e}finally{try{!i&&o.return&&o.return()}finally{if(n)throw s}}return z(e.taskId,e.taskName,e.userIds,a,e.reviewerIds)},splitTask:function(e,t){return Object(s.e)("/api/admin/splitTask",{taskId:e,quantity:t})},deleteTask:function(e){return Object(s.e)("/api/admin/deleteTask",{taskId:e})},updateTaskType:function(e){return new Promise(function(t,a){var i=0,n=function(n){Object(s.e)("/api/admin/updateTaskType",{taskId:n.taskId,taskType:n.taskType}).then(function(){++i==e.length&&t()}).catch(function(e){console.error(e),a({code:e.code,message:"处理taskId:'"+n.taskId+"'出现错误:"+e.message})})},l=!0,o=!1,r=void 0;try{for(var c,u=e[Symbol.iterator]();!(l=(c=u.next()).done);l=!0)n(c.value)}catch(e){o=!0,r=e}finally{try{!l&&u.return&&u.return()}finally{if(o)throw r}}})},getNewTaskList:function(){return Object(s.c)("/api/admin/getNewTaskList")},search:function(e){var t={keyword:e};return Object(s.e)("/api/admin/searchTask",t)}},B={name:"partition",data:function(){return{taskData:this.global.task,userSelect:{dialogVisible:!1,tableData:[],tableSelect:[],type:"user",taskItem:[],loading:!1},labelSelect:{dialogVisible:!1,tableData:[],tableSelect:[],index:[],taskItem:[],loading:!1},typeSelect:{dialogVisible:!1,select:"",taskItem:null,loading:!1},newTask:{list:[],dialogVisible:!1,loading:!1,type:[{value:1,label:"分类"},{value:2,label:"检测"},{value:3,label:"分割"},{value:4,label:"关键点"}]},account:this.global.account,loading:!1,split:{dialogVisible:!1,count:2,item:""},page:{now:1,total:1},search:""}},methods:{newTaskAdd:function(){var e=this;this.newTask.dialogVisible=!0,this.newTask.loading=!0,F.getNewTaskList().then(function(t){e.newTask.list=t.data.taskList,e.newTask.loading=!1}).catch(function(t){e.$message({type:"error",message:"获取列表失败,"+t.message+"("+t.code+")"})}).then(function(){e.newTask.loading=!1})},newTaskAddSubmit:function(){var e=this;this.newTask.loading=!0,F.updateTaskType(this.newTask.list).then(function(){e.$message({type:"success",message:"添加成功"}),e.typeSelect.dialogVisible=!1,e.showList()}).catch(function(t){e.$message({type:"error",message:"添加失败,"+t.message+"("+t.code+")"})}).then(function(){e.newTask.loading=!1})},typeSubmit:function(){var e=this;this.typeSelect.loading=!0,F.updateTaskType([{taskId:this.typeSelect.taskItem.taskId,taskType:this.typeSelect.select}]).then(function(){e.$message({type:"success",message:"添加成功"}),e.typeSelect.dialogVisible=!1,e.showList()}).catch(function(t){e.$message({type:"error",message:"添加失败,"+t.message+"("+t.code+")"})}).then(function(){e.typeSelect.loading=!1})},showList:function(){var e=this;this.loading=!0,F.getTaskList(this.page.now).then(function(t){e.page.total=t.data.totalpages?t.data.totalpages:1,e.global.task.list=t.data.taskList}).catch(function(t){e.$message({type:"error",message:"获取列表失败,"+t.message+"("+t.code+")"})}).then(function(){e.loading=!1})},searchClick:function(){var e=this;this.page.now=1,""!=this.search?(this.loading=!0,F.search(this.search).then(function(t){e.global.task.list=t.data}).catch(function(t){e.$message({type:"error",message:"搜索失败,"+t.message+"("+t.code+")"})}).then(function(){e.loading=!1})):this.showList()},editUser:function(e){var t=[!0,"user",e];this.userSelect.dialogVisible=t[0],this.userSelect.type=t[1],this.userSelect.taskItem=t[2]},editReviewer:function(e){var t=[!0,"reviewer",e];this.userSelect.dialogVisible=t[0],this.userSelect.type=t[1],this.userSelect.taskItem=t[2]},editLabel:function(e){var t=[!0,e];this.labelSelect.dialogVisible=t[0],this.labelSelect.taskItem=t[1]},editType:function(e){var t=[!0,e,e.taskType];this.typeSelect.dialogVisible=t[0],this.typeSelect.taskItem=t[1],this.typeSelect.select=t[2]},setUserTable:function(){var e=this;this.loading=!0,this.userSelect.dialogVisible=!1,("user"==this.userSelect.type?F.setUser(this.userSelect.taskItem,this.userSelect.tableSelect,this.account):F.setReviewer(this.userSelect.taskItem,this.userSelect.tableSelect,this.account)).then(function(){e.$message({type:"success",message:"保存成功"})}).catch(function(t){e.$message({type:"error",message:"保存失败,"+t.message+"("+t.code+")"})}).then(function(){e.loading=!1,e.showList()})},openUserDialog:function(){var e=this;this.$nextTick(function(){e.userSelect.loading=!0,F.getList(e.userSelect.taskItem,"reviewer"==e.userSelect.type?"Reviewer":"User").then(function(t){e.userSelect.tableData=t,e.$nextTick(function(){e.userSelect.tableSelect=[];var a=!0,i=!1,n=void 0;try{for(var s,l=t[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var o=s.value;o.join?e.$refs.table.toggleRowSelection(o,!0):e.$refs.table.toggleRowSelection(o,!1)}}catch(e){i=!0,n=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw n}}})}).catch(function(t){e.$message({type:"error",message:"获取帐号列表失败,"+t.message+"("+t.code+")"})}).then(function(){e.userSelect.loading=!1})})},handleSelectionChange:function(e){this.userSelect.tableSelect=e},setLabelTable:function(){var e=this;this.loading=!0,this.labelSelect.dialogVisible=!1,console.log(this.labelSelect.tableSelect),F.setLabel(this.labelSelect.taskItem,this.labelSelect.tableSelect,this.account).then(function(){e.$message({type:"success",message:"保存成功"})}).catch(function(t){e.$message({type:"error",message:"保存失败,"+t.message+"("+t.code+")"})}).then(function(){e.loading=!1,e.showList()})},labelSelectionChange:function(e){if(5==this.labelSelect.taskItem.taskType&&e.length>1)return this.$message({type:"error",message:"只可选择一个模板"}),this.$refs.labelTable.toggleRowSelection(this.labelSelect.tableSelect[0]),this.labelSelect.tableSelect=[this.labelSelect.tableSelect[this.labelSelect.tableSelect.length-1]],!1;if(this.labelSelect.index=[],4==this.labelSelect.taskItem.taskType){var t=1,a=!0,i=!1,n=void 0;try{for(var s,l=e[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var o=s.value;this.labelSelect.index[o.labelName]=t++}}catch(e){i=!0,n=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw n}}}this.labelSelect.tableSelect=e},openSelectDialog:function(){var e=this;this.$nextTick(function(){e.labelSelect.loading=!0,F.getLabelList(e.labelSelect.taskItem.taskType,e.labelSelect.taskItem.labelIds).then(function(t){e.labelSelect.tableData=t,e.$nextTick(function(){e.labelSelect.tableSelect=[];var a=!0,i=!1,n=void 0;try{for(var s,l=t[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var o=s.value;o.join?e.$refs.labelTable.toggleRowSelection(o,!0):e.$refs.labelTable.toggleRowSelection(o,!1)}}catch(e){i=!0,n=e}finally{try{!a&&l.return&&l.return()}finally{if(i)throw n}}})}).catch(function(t){e.$message({type:"error",message:"获取标签失败,"+t.message+"("+t.code+")"})}).then(function(){e.labelSelect.loading=!1})})},splitTask:function(e){e.imageNumber<=1?this.$alert("该任务只存在一项项目，无法继续分割","出现错误",{confirmButtonText:"确定"}):(this.split.item=e,this.split.dialogVisible=!0)},splitSubmit:function(){var e=this;this.loading=!0,F.splitTask(this.split.item.taskId,this.split.count,this.account).then(function(){e.$message({type:"success",message:"拆分成功"})}).catch(function(t){e.$message({type:"error",message:"拆分失败,"+t.message+"("+t.code+")"})}).then(function(){e.split.dialogVisible=!1,e.showList()})},deleteTask:function(e){var t=this;this.$confirm("将永久删除数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.loading=!0,F.deleteTask(e.taskId,t.account).then(function(){t.$message({type:"success",message:"删除成功"})}).catch(function(e){t.$message({type:"error",message:"删除成功失败,"+e.message+"("+e.code+")"})}).then(function(){t.loading=!1,t.showList()})})},getTypeName:function(e){switch(e){case 1:return"分类";case 2:return"检测";case 3:return"分割";case 4:return"关键点检测";case 5:return"视频描述";default:return"未知类型"}},filterTag:function(e,t){return t.taskType==e},pageChange:function(e){this.showList()}},mounted:function(){this.showList()}},W={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},on:{click:e.newTaskAdd}},[e._v("添加任务")]),e._v(" "),a("el-button",{attrs:{icon:"el-icon-refresh-left"},on:{click:e.showList}},[e._v("刷新列表")]),e._v(" "),a("el-input",{staticClass:"search",attrs:{"prefix-icon":"el-icon-search",placeholder:"搜索任务（回车确认）"},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchClick(t)}},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"10px"},attrs:{border:"",data:e.taskData.list,stripe:""}},[a("el-table-column",{attrs:{filters:[{text:"分类",value:"1"},{text:"检测",value:"2"},{text:"分割",value:"3"},{text:"关键点检测",value:"4"},{text:"视频描述",value:"5"}],"filter-method":e.filterTag,"filter-placement":"bottom-end",prop:"authorities",label:"类型",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e.getTypeName(t.row.taskType))+"\n      ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"taskName","min-width":"100",label:"任务名"}}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"530"},scopedSlots:e._u([{key:"default",fn:function(t){return[5!=t.row.taskType?a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.editType(t.row)}}},[e._v("选择类型")]):e._e(),e._v(" "),a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.editUser(t.row)}}},[e._v("选择用户")]),e._v(" "),a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.editReviewer(t.row)}}},[e._v("选择审核")]),e._v(" "),a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.editLabel(t.row)}}},[e._v("选择标签")]),e._v(" "),a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.splitTask(t.row)}}},[e._v("拆分")]),e._v(" "),a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return e.deleteTask(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("el-dialog",{attrs:{title:"user"==e.userSelect.type?"选择用户":"选择审核",visible:e.userSelect.dialogVisible,width:"400px"},on:{"update:visible":function(t){return e.$set(e.userSelect,"dialogVisible",t)},open:e.openUserDialog}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.userSelect.loading,expression:"userSelect.loading"}],ref:"table",staticStyle:{width:"100%"},attrs:{data:e.userSelect.tableData},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{prop:"join",type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{label:"用户名",prop:"username"}})],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.userSelect.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.setUserTable}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"选择标签",visible:e.labelSelect.dialogVisible,width:"400px"},on:{"update:visible":function(t){return e.$set(e.labelSelect,"dialogVisible",t)},open:e.openSelectDialog}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.labelSelect.loading,expression:"labelSelect.loading"}],ref:"labelTable",staticStyle:{width:"100%"},attrs:{data:e.labelSelect.tableData},on:{"selection-change":e.labelSelectionChange}},[a("el-table-column",{attrs:{prop:"join",type:"selection",width:"55"}}),e._v(" "),5!=e.labelSelect.taskItem.taskType?[a("el-table-column",{attrs:{label:"标签名称",prop:"labelName"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.labelSelect.index[t.row.labelName]?a("el-tag",{staticClass:"task-tag",attrs:{effect:"plain",size:"mini"}},[e._v(e._s(e.labelSelect.index[t.row.labelName]))]):e._e(),e._v(e._s(t.row.labelName)+"\n          ")]}}],null,!1,883129105)})]:[a("el-table-column",{attrs:{label:"类型",prop:"type"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(0==t.row.type?"空白":1==t.row.type?"填空":"选择"))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"描述",prop:"question"}})]],2),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.labelSelect.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.setLabelTable}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{title:"任务拆分",visible:e.split.dialogVisible,width:"30%"},on:{"update:visible":function(t){return e.$set(e.split,"dialogVisible",t)}}},[a("el-form",{attrs:{inline:!0}},[a("el-form-item",{attrs:{label:"拆分数量"}},[a("el-input-number",{attrs:{min:2,max:e.split.item.imageNumber,step:1,"step-strictly":""},model:{value:e.split.count,callback:function(t){e.$set(e.split,"count",t)},expression:"split.count"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.split.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.splitSubmit}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.typeSelect.loading,expression:"typeSelect.loading"}],attrs:{title:"任务类型",visible:e.typeSelect.dialogVisible,width:"30%"},on:{"update:visible":function(t){return e.$set(e.typeSelect,"dialogVisible",t)}}},[a("el-form",{attrs:{inline:!0}},[a("el-form-item",{attrs:{label:"类型",prop:"group"}},[a("el-select",{attrs:{placeholder:"请选择任务类型"},model:{value:e.typeSelect.select,callback:function(t){e.$set(e.typeSelect,"select",t)},expression:"typeSelect.select"}},e._l(e.newTask.type,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.typeSelect.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.typeSubmit}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.newTask.loading,expression:"newTask.loading"}],attrs:{title:"导入新任务",visible:e.newTask.dialogVisible,width:"60%"},on:{"update:visible":function(t){return e.$set(e.newTask,"dialogVisible",t)}}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"10px"},attrs:{border:"",data:e.newTask.list,stripe:""}},[a("el-table-column",{attrs:{prop:"taskName","min-width":"100",label:"任务名"}}),e._v(" "),a("el-table-column",{attrs:{label:"设置类型",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[5!=t.row.taskType?a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.row.taskType,callback:function(a){e.$set(t.row,"taskType",a)},expression:"scope.row.taskType"}},e._l(e.newTask.type,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1):a("span",[e._v("视频描述")])]}}])})],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.newTaskAddSubmit}},[e._v("全部添加")])],1)],1),e._v(" "),e.page.total>1?a("el-pagination",{staticClass:"pagination",attrs:{background:"",layout:"prev, pager, next,jumper","page-count":e.page.total,"current-page":e.page.now},on:{"current-change":e.pageChange,"update:currentPage":function(t){return e.$set(e.page,"now",t)},"update:current-page":function(t){return e.$set(e.page,"now",t)}}}):e._e()],1)},staticRenderFns:[]},H=a("VU/8")(B,W,!1,null,null,null).exports,K={name:"list",data:function(){return{taskData:[],account:this.global.account,loading:!1,page:{now:1,total:1}}},methods:{showList:function(){var e=this;if(0==this.account.group)return!1;this.loading=!0,function(){var e=localStorage.getItem("group"),t=localStorage.getItem("id"),a=Object(s.g)(e);if(1==e||2==e){var i={};return i[a+"Id"]=t,Object(s.e)("/api/"+a+"/taskList",i)}return Object(s.c)("/api/"+a+"/taskList")}(this.account).then(function(t){e.taskData=t.data.taskList?t.data.taskList:t.data}).catch(function(t){console.error(t),e.$message({type:"error",message:"获取任务列表失败"})}).then(function(){e.loading=!1})},enterTask:function(e){this.$router.push({path:"/task/"+e.taskId+"/"+e.taskName+"/"+e.taskType})},downloadTask:function(e){var t,a,i=this;3==this.account.group?(this.$message({type:"info",message:"正在准备数据..."}),(t=e.taskId,a={taskId:t},new Promise(function(e,t){Object(s.d)("/api/admin/downloadDatas",a).then(function(t){console.log(t);var a=new Blob([JSON.stringify(t.d,null,2)],{type:"application/json"});e({blob:a,filename:t.f})}).catch(function(e){t(e)})})).then(function(t){var a=new Date,i=a.getMonth()+1+"",n=a.getDay()+1+"",s=a.getHours()+"",l=a.getSeconds()+"",o=a.getMinutes()+"";i=1==i.length?"0"+i:i,n=1==n.length?"0"+n:n,s=1==s.length?"0"+s:s,o=1==o.length?"0"+o:o,l=1==l.length?"0"+l:l;var r=e.taskName+"_"+a.getFullYear()+"-"+i+"-"+n+"_"+s+"-"+o+"-"+l,c=t.blob,u=document.createElement("a");u.download=r,u.style.display="none",u.href=URL.createObjectURL(c),document.body.appendChild(u),u.click(),document.body.removeChild(u)}).catch(function(e){i.$message({type:"error",message:"数据获取失败: "+e.message+"("+e.code+")"})})):this.$message({type:"error",message:"权限不足"})},getTypeName:function(e){switch(e){case 1:return"分类";case 2:return"检测";case 3:return"分割";case 4:return"关键点检测";case 5:return"视频描述";default:return"未知类型"}},filterTag:function(e,t){return t.taskType==e},pageChange:function(e){this.showList()}},mounted:function(){this.showList()}},X={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-button",{attrs:{icon:"el-icon-refresh-left"},on:{click:e.showList}},[e._v("刷新列表")]),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"10px"},attrs:{border:"",data:e.taskData,stripe:""}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{staticClass:"table-expand",attrs:{"label-position":"left",inline:""}},[a("el-form-item",{attrs:{label:"标注人员"}},[null!=t.row.users&&0!=t.row.users.length?e._l(t.row.users,function(i){return a("span",{key:i.userId,staticClass:"person"},[e._v("\n                "+e._s(i.username)+"("+e._s(i.labeled)+"/"+e._s(t.row.imageNumber)+")\n              ")])}):a("span",[e._v("未指派标注人员")])],2),e._v(" "),a("el-form-item",{attrs:{label:"审核人员"}},[null!=t.row.reviewers&&0!=t.row.reviewers.length?e._l(t.row.reviewers,function(t){return a("span",{key:t,staticClass:"person"},[e._v("\n                "+e._s(t)+"\n              ")])}):a("span",[e._v("未指派审核人员")])],2)],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{filters:[{text:"分类",value:"1"},{text:"检测",value:"2"},{text:"分割",value:"3"},{text:"关键点检测",value:"4"},{text:"视频描述",value:"5"}],"filter-method":e.filterTag,"filter-placement":"bottom-end",prop:"authorities",label:"类型",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(e.getTypeName(t.row.taskType))+"\n      ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"taskName","min-width":"100",label:"名称"}}),e._v(" "),a("el-table-column",{attrs:{label:"进度(已完成审核数/总图片数)"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.finish)+"/"+e._s(t.row.imageNumber)+"\n      ")]}}])}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:3==e.account.group?220:80},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){return e.enterTask(t.row)}}},[e._v("进入")]),e._v(" "),3==e.account.group?a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.downloadTask(t.row)}}},[e._v("下载已完成项")]):e._e()]}}])})],1)],1)},staticRenderFns:[]};var J=a("VU/8")(K,X,!1,function(e){a("0GEF")},null,null).exports;i.default.use(n.a);var G=new n.a({routes:[{path:"/",redirect:"/dashboard"},{path:"/",name:"Index",component:f,props:!0,children:[{path:"dashboard",name:"Dashboard",component:k,props:!0,meta:{title:"仪表盘 - "+s.b}},{path:"task/:id/:taskName/:type",name:"Task",component:x,props:!0,meta:{title:"任务详情 - "+s.b}},{path:"user",name:"User",component:D,props:!0,meta:{title:"账户列表 - "+s.b}},{path:"partition",name:"Partition",component:H,props:!0,meta:{title:"任务操作 - "+s.b}},{path:"list",name:"List",component:J,props:!0,meta:{title:"任务列表 - "+s.b}},{path:"label",name:"Labelset",component:P,props:!0,meta:{title:"标签列表 - "+s.b}},{path:"videolabel",name:"LabelsetVideo",component:O,props:!0,meta:{title:"视频标签列表 - "+s.b}}]},{path:"/img/:id/:tid/:type/:taskName/:imagePage",name:"Label",component:T,props:!0,meta:{title:"标记 - "+s.b}},{path:"/video/:id/:tid/:taskName/:imagePage",name:"VideoLabel",component:V,props:!0,meta:{title:"视频标记 - "+s.b}},{path:"/login/:path",name:"Login",component:m,props:!0,meta:{title:"登录 - "+s.b}},{path:"/check/:path",name:"Check",component:g,props:!0,meta:{title:"Loading..."}}]}),Y=a("zL8q"),Z=a.n(Y),Q={render:function(){var e=this.$createElement,t=this._self._c||e;return t("transition",[t("router-view")],1)},staticRenderFns:[]};var ee=a("VU/8")({name:"app",data:function(){return{account:this.global.account}},mounted:function(){-1==this.$route.fullPath.indexOf("/login")&&this.$router.push("/check/"+this.$route.fullPath.replace("/","").replace(/\//g,","))}},Q,!1,function(e){a("88+d")},"data-v-7260c5a7",null).exports,te={account:{username:"",group:0,token:"",id:0},task:{list:[]}};a("tvR6"),a("J373");i.default.config.productionTip=!1,i.default.use(Z.a),i.default.prototype.global=te,G.beforeEach(function(e,t,a){e.meta.title&&(document.title=e.meta.title),a()}),console.log(te),new i.default({el:"#app",router:G,components:{App:ee},template:"<App/>"})},S4Wm:function(e,t){},TLgD:function(e,t){},c1um:function(e,t,a){"use strict";a.d(t,"a",function(){return i}),a.d(t,"c",function(){return o}),a.d(t,"e",function(){return s}),a.d(t,"d",function(){return l}),a.d(t,"g",function(){return c}),a.d(t,"b",function(){return n}),a.d(t,"f",function(){return r});var i="http://47.100.254.133:23333",n="DIG数据标注平台";function s(e,t,a){var n=localStorage.getItem("token"),s={"Content-Type":"/api/login"==e?"application/x-www-form-urlencoded":"application/json"};return"/api/login"!=e&&(s.Authorization="Bearer "+(n||"")),new Promise(function(l,o){fetch(i+e,{method:"POST",credentials:"include",headers:s,body:"/api/login"==e?t:JSON.stringify(t)}).then(function(e){return e.headers.Authorization&&e.headers.Authorization.replace("Bearer ","")!=n&&localStorage.setItem("token",e.headers.Authorization.replace("Bearer ","")),e.json()}).then(function(e){200==e.code||a?l(e):o(e)}).catch(function(e,t){console.log(t),o({code:-1,message:"未知错误"})})})}function l(e,t){var a=localStorage.getItem("token"),n={"Content-Type":"application/json"};return n.Authorization="Bearer "+(a||""),new Promise(function(s,l){fetch(i+e,{method:"POST",credentials:"include",headers:n,body:JSON.stringify(t)}).then(function(e){if(e.headers.Authorization&&e.headers.Authorization.replace("Bearer ","")!=a&&localStorage.setItem("token",e.headers.Authorization.replace("Bearer ","")),"application/octet-stream"==e.headers.get("content-type")){e.json().then(function(e){s({f:"",d:e})})}else{e.json().then(function(e){l({code:e.code,message:e.message})})}}).catch(function(e,t){console.log(t),l({code:-1,message:"未知错误"})})})}function o(e){var t=localStorage.getItem("token");return new Promise(function(a,n){fetch(i+e,{credentials:"include",headers:{Authorization:"Bearer "+(t||"")}}).then(function(e){return e.headers.Authorization&&e.headers.Authorization.replace("Bearer ","")!=t&&localStorage.setItem("token",e.headers.Authorization.replace("Bearer ","")),e.json()}).then(function(e){200==e.code?a(e):n(e)}).catch(function(){n({code:-1,message:"未知错误"})})})}function r(e){var t=localStorage.getItem("token");return console.log(t),new Promise(function(a,n){fetch(i+e,{credentials:"include",headers:{Authorization:"Bearer "+(t||"")}}).then(function(e){if(e.headers.get("Authorization")&&e.headers.get("Authorization").replace("Bearer ","")!=t&&localStorage.setItem("token",e.headers.get("Authorization").replace("Bearer ","")),302!=e.status&&500!=e.status)return e.json();n()}).then(function(e){500!=e.code?a():n()}).catch(function(){n()})})}function c(e){var t=parseInt(e);return 1==t?"user":3==t?"admin":"reviewer"}},cvqD:function(e,t){},lZzK:function(e,t){},mGSw:function(e,t){},mqF5:function(e,t){},qlky:function(e,t){},rJcc:function(e,t){},suMn:function(e,t,a){"use strict";var i=a("c1um");t.a={getVideo:function(e,t){var a=localStorage.getItem("group"),n=Object(i.g)(a),s={videoId:e};return void 0!=t&&(s.userId=t),Object(i.e)("/api/"+n+"/getVideo",s)},getVideoList:function(e,t){var a=localStorage.getItem("group"),n=Object(i.g)(a),s=localStorage.getItem("id"),l={taskId:e,page:t,limit:30};return l[n+"Id"]=s,Object(i.e)("/api/"+n+"/getVideoList",l)},saveVideoLabel:function(e,t,a){var n=localStorage.getItem("group"),s=Object(i.g)(n),l=localStorage.getItem("id"),o={userId:a||l,videoId:e,data:t};return Object(i.e)("/api/"+s+"/saveVideoLabel ",o)},getPendingUserList:function(e){var t=localStorage.getItem("group"),a=Object(i.g)(t);return Object(i.e)("/api/"+a+"/getVideoPendingUserList",{videoId:e})},setVideoFinalVersion:function(e,t){var a=localStorage.getItem("group"),n=Object(i.g)(a);return Object(i.e)("/api/"+n+"/setVideoFinalVersion",{videoId:e,userConfirmId:t})},getLabelList:function(){return Object(i.c)("/api/admin/getVideoLabelList")},deleteLabel:function(e){return Object(i.e)("/api/admin/deleteVideoLabel",{labelId:e})},addLabel:function(e,t,a){return Object(i.e)("/api/admin/addVideoLabel",{type:e,question:t,selector:a})},editLabel:function(e,t,a,n){return Object(i.e)("/api/admin/editVideoLabel",{labelId:e,type:t,question:a,selector:n})}}},tvR6:function(e,t){},vGvD:function(e,t){},xn2C:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.87749ca8a27403ef09a6.js.map